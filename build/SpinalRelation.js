"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _Utilities = require("./Utilities");

const spinalCore = require("spinal-core-connectorjs");
const globalType = typeof window === "undefined" ? global : window;
let getViewer = function () {
  return globalType.v;
};

class SpinalRelation extends globalType.Model {
  constructor(_type, _nodeList1, _nodeList2, _isDirected, name = "SpinalRelation") {
    super();
    if (FileSystem._sig_server) {
      this.add_attr({
        id: _Utilities.Utilities.guid(this.constructor.name),
        type: _type,
        nodeList1: _nodeList1,
        nodeList2: _nodeList2,
        isDirected: _isDirected || false
      });
    }
  }

  getNodeList1Ids() {
    let t = [];
    for (let index = 0; index < this.nodeList1.length; index++) {
      const element = this.nodeList1[index];
      t.push(element.id.get());
    }
    return t;
  }

  getNodeList2Ids() {
    let t = [];
    for (let index = 0; index < this.nodeList2.length; index++) {
      const element = this.nodeList2[index];
      t.push(element.id.get());
    }
    return t;
  }

  getNodeList1List2Ids() {
    let t = [];
    for (let index = 0; index < this.nodeList1.length; index++) {
      const element = this.nodeList1[index];
      t.push(element.id.get());
    }
    for (let index = 0; index < this.nodeList2.length; index++) {
      const element = this.nodeList2[index];
      t.push(element.id.get());
    }
    return t;
  }

  addNotExistingNodetoNodeList1(_node) {
    if (!_Utilities.Utilities.contains(this.nodeList1, _node)) this.nodeList1.push(_node);
  }

  addNotExistingNodestoNodeList1(_nodes) {
    for (let index = 0; index < _nodes.length; index++) {
      const element = _nodes[index];
      this.addNotExistingNodetoNodeList1(element);
    }
  }

  addNotExistingNodetoNodeList2(_node) {
    if (!_Utilities.Utilities.contains(this.nodeList2, _node)) this.nodeList2.push(_node);
  }

  addNotExistingNodestoNodeList2(_nodes) {
    console.log(_nodes);

    for (let index = 0; index < _nodes.length; index++) {
      const element = _nodes[index];
      this.addNotExistingNodetoNodeList2(element);
    }
  }

  addNotExistingNodetoRelation(_relation) {
    other = [];
    for (let index = 0; index < _relation.nodeList1.length; index++) {
      const element = _relation.nodeList1[index];
      other.push(element);
    }
    for (let index = 0; index < _relation.nodeList2.length; index++) {
      const element = _relation.nodeList2[index];
      other.push(element);
    }

    me = [];
    for (let index = 0; index < this.nodeList1.length; index++) {
      const element = this.nodeList1[index];
      me.push(element);
    }
    for (let index = 0; index < this.nodeList2.length; index++) {
      const element = this.nodeList2[index];
      me.push(element);
    }
    for (let index = 0; index < other.length; index++) {
      const node = other[index];
      if (!_Utilities.Utilities.contains(me, node)) this.nodeList2.push(node);
    }
  }

  toJson() {
    return {
      id: this.id.get(),
      type: this.type.get(),
      nodeList1: this.getNodeList1Ids(),
      nodeList2: this.getNodeList2Ids(),
      isDirected: this.isDirected.get()
    };
  }

  toIfc(element1Id, element2Id) {
    return this.type + '(' + this.id.get() + ',' + '$' + '$' + element1Id + ',' + element2Id + ');';
  }
}

exports.default = SpinalRelation;
spinalCore.register_models([SpinalRelation]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9TcGluYWxSZWxhdGlvbi5qcyJdLCJuYW1lcyI6WyJzcGluYWxDb3JlIiwicmVxdWlyZSIsImdsb2JhbFR5cGUiLCJ3aW5kb3ciLCJnbG9iYWwiLCJnZXRWaWV3ZXIiLCJ2IiwiU3BpbmFsUmVsYXRpb24iLCJNb2RlbCIsImNvbnN0cnVjdG9yIiwiX3R5cGUiLCJfbm9kZUxpc3QxIiwiX25vZGVMaXN0MiIsIl9pc0RpcmVjdGVkIiwibmFtZSIsIkZpbGVTeXN0ZW0iLCJfc2lnX3NlcnZlciIsImFkZF9hdHRyIiwiaWQiLCJVdGlsaXRpZXMiLCJndWlkIiwidHlwZSIsIm5vZGVMaXN0MSIsIm5vZGVMaXN0MiIsImlzRGlyZWN0ZWQiLCJnZXROb2RlTGlzdDFJZHMiLCJ0IiwiaW5kZXgiLCJsZW5ndGgiLCJlbGVtZW50IiwicHVzaCIsImdldCIsImdldE5vZGVMaXN0MklkcyIsImdldE5vZGVMaXN0MUxpc3QySWRzIiwiYWRkTm90RXhpc3RpbmdOb2RldG9Ob2RlTGlzdDEiLCJfbm9kZSIsImNvbnRhaW5zIiwiYWRkTm90RXhpc3RpbmdOb2Rlc3RvTm9kZUxpc3QxIiwiX25vZGVzIiwiYWRkTm90RXhpc3RpbmdOb2RldG9Ob2RlTGlzdDIiLCJhZGROb3RFeGlzdGluZ05vZGVzdG9Ob2RlTGlzdDIiLCJjb25zb2xlIiwibG9nIiwiYWRkTm90RXhpc3RpbmdOb2RldG9SZWxhdGlvbiIsIl9yZWxhdGlvbiIsIm90aGVyIiwibWUiLCJub2RlIiwidG9Kc29uIiwidG9JZmMiLCJlbGVtZW50MUlkIiwiZWxlbWVudDJJZCIsInJlZ2lzdGVyX21vZGVscyJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBTUE7O0FBTkEsTUFBTUEsYUFBYUMsUUFBUSx5QkFBUixDQUFuQjtBQUNBLE1BQU1DLGFBQWEsT0FBT0MsTUFBUCxLQUFrQixXQUFsQixHQUFnQ0MsTUFBaEMsR0FBeUNELE1BQTVEO0FBQ0EsSUFBSUUsWUFBWSxZQUFXO0FBQ3pCLFNBQU9ILFdBQVdJLENBQWxCO0FBQ0QsQ0FGRDs7QUFRZSxNQUFNQyxjQUFOLFNBQTZCTCxXQUFXTSxLQUF4QyxDQUE4QztBQUMzREMsY0FBWUMsS0FBWixFQUFtQkMsVUFBbkIsRUFBK0JDLFVBQS9CLEVBQTJDQyxXQUEzQyxFQUF3REMsT0FDdEQsZ0JBREYsRUFDb0I7QUFDbEI7QUFDQSxRQUFJQyxXQUFXQyxXQUFmLEVBQTRCO0FBQzFCLFdBQUtDLFFBQUwsQ0FBYztBQUNaQyxZQUFJQyxxQkFBVUMsSUFBVixDQUFlLEtBQUtYLFdBQUwsQ0FBaUJLLElBQWhDLENBRFE7QUFFWk8sY0FBTVgsS0FGTTtBQUdaWSxtQkFBV1gsVUFIQztBQUlaWSxtQkFBV1gsVUFKQztBQUtaWSxvQkFBWVgsZUFBZTtBQUxmLE9BQWQ7QUFPRDtBQUNGOztBQUVEWSxvQkFBa0I7QUFDaEIsUUFBSUMsSUFBSSxFQUFSO0FBQ0EsU0FBSyxJQUFJQyxRQUFRLENBQWpCLEVBQW9CQSxRQUFRLEtBQUtMLFNBQUwsQ0FBZU0sTUFBM0MsRUFBbURELE9BQW5ELEVBQTREO0FBQzFELFlBQU1FLFVBQVUsS0FBS1AsU0FBTCxDQUFlSyxLQUFmLENBQWhCO0FBQ0FELFFBQUVJLElBQUYsQ0FBT0QsUUFBUVgsRUFBUixDQUFXYSxHQUFYLEVBQVA7QUFDRDtBQUNELFdBQU9MLENBQVA7QUFDRDs7QUFFRE0sb0JBQWtCO0FBQ2hCLFFBQUlOLElBQUksRUFBUjtBQUNBLFNBQUssSUFBSUMsUUFBUSxDQUFqQixFQUFvQkEsUUFBUSxLQUFLSixTQUFMLENBQWVLLE1BQTNDLEVBQW1ERCxPQUFuRCxFQUE0RDtBQUMxRCxZQUFNRSxVQUFVLEtBQUtOLFNBQUwsQ0FBZUksS0FBZixDQUFoQjtBQUNBRCxRQUFFSSxJQUFGLENBQU9ELFFBQVFYLEVBQVIsQ0FBV2EsR0FBWCxFQUFQO0FBQ0Q7QUFDRCxXQUFPTCxDQUFQO0FBQ0Q7O0FBRURPLHlCQUF1QjtBQUNyQixRQUFJUCxJQUFJLEVBQVI7QUFDQSxTQUFLLElBQUlDLFFBQVEsQ0FBakIsRUFBb0JBLFFBQVEsS0FBS0wsU0FBTCxDQUFlTSxNQUEzQyxFQUFtREQsT0FBbkQsRUFBNEQ7QUFDMUQsWUFBTUUsVUFBVSxLQUFLUCxTQUFMLENBQWVLLEtBQWYsQ0FBaEI7QUFDQUQsUUFBRUksSUFBRixDQUFPRCxRQUFRWCxFQUFSLENBQVdhLEdBQVgsRUFBUDtBQUNEO0FBQ0QsU0FBSyxJQUFJSixRQUFRLENBQWpCLEVBQW9CQSxRQUFRLEtBQUtKLFNBQUwsQ0FBZUssTUFBM0MsRUFBbURELE9BQW5ELEVBQTREO0FBQzFELFlBQU1FLFVBQVUsS0FBS04sU0FBTCxDQUFlSSxLQUFmLENBQWhCO0FBQ0FELFFBQUVJLElBQUYsQ0FBT0QsUUFBUVgsRUFBUixDQUFXYSxHQUFYLEVBQVA7QUFDRDtBQUNELFdBQU9MLENBQVA7QUFDRDs7QUFFRFEsZ0NBQThCQyxLQUE5QixFQUFxQztBQUNuQyxRQUFJLENBQUNoQixxQkFBVWlCLFFBQVYsQ0FBbUIsS0FBS2QsU0FBeEIsRUFBbUNhLEtBQW5DLENBQUwsRUFDRSxLQUFLYixTQUFMLENBQWVRLElBQWYsQ0FBb0JLLEtBQXBCO0FBQ0g7O0FBRURFLGlDQUErQkMsTUFBL0IsRUFBdUM7QUFDckMsU0FBSyxJQUFJWCxRQUFRLENBQWpCLEVBQW9CQSxRQUFRVyxPQUFPVixNQUFuQyxFQUEyQ0QsT0FBM0MsRUFBb0Q7QUFDbEQsWUFBTUUsVUFBVVMsT0FBT1gsS0FBUCxDQUFoQjtBQUNBLFdBQUtPLDZCQUFMLENBQW1DTCxPQUFuQztBQUNEO0FBQ0Y7O0FBRURVLGdDQUE4QkosS0FBOUIsRUFBcUM7QUFDbkMsUUFBSSxDQUFDaEIscUJBQVVpQixRQUFWLENBQW1CLEtBQUtiLFNBQXhCLEVBQW1DWSxLQUFuQyxDQUFMLEVBQ0UsS0FBS1osU0FBTCxDQUFlTyxJQUFmLENBQW9CSyxLQUFwQjtBQUNIOztBQUVESyxpQ0FBK0JGLE1BQS9CLEVBQXVDO0FBQ3JDRyxZQUFRQyxHQUFSLENBQVlKLE1BQVo7O0FBRUEsU0FBSyxJQUFJWCxRQUFRLENBQWpCLEVBQW9CQSxRQUFRVyxPQUFPVixNQUFuQyxFQUEyQ0QsT0FBM0MsRUFBb0Q7QUFDbEQsWUFBTUUsVUFBVVMsT0FBT1gsS0FBUCxDQUFoQjtBQUNBLFdBQUtZLDZCQUFMLENBQW1DVixPQUFuQztBQUNEO0FBQ0Y7O0FBRURjLCtCQUE2QkMsU0FBN0IsRUFBd0M7QUFDdENDLFlBQVEsRUFBUjtBQUNBLFNBQUssSUFBSWxCLFFBQVEsQ0FBakIsRUFBb0JBLFFBQVFpQixVQUFVdEIsU0FBVixDQUFvQk0sTUFBaEQsRUFBd0RELE9BQXhELEVBQWlFO0FBQy9ELFlBQU1FLFVBQVVlLFVBQVV0QixTQUFWLENBQW9CSyxLQUFwQixDQUFoQjtBQUNBa0IsWUFBTWYsSUFBTixDQUFXRCxPQUFYO0FBQ0Q7QUFDRCxTQUFLLElBQUlGLFFBQVEsQ0FBakIsRUFBb0JBLFFBQVFpQixVQUFVckIsU0FBVixDQUFvQkssTUFBaEQsRUFBd0RELE9BQXhELEVBQWlFO0FBQy9ELFlBQU1FLFVBQVVlLFVBQVVyQixTQUFWLENBQW9CSSxLQUFwQixDQUFoQjtBQUNBa0IsWUFBTWYsSUFBTixDQUFXRCxPQUFYO0FBQ0Q7O0FBRURpQixTQUFLLEVBQUw7QUFDQSxTQUFLLElBQUluQixRQUFRLENBQWpCLEVBQW9CQSxRQUFRLEtBQUtMLFNBQUwsQ0FBZU0sTUFBM0MsRUFBbURELE9BQW5ELEVBQTREO0FBQzFELFlBQU1FLFVBQVUsS0FBS1AsU0FBTCxDQUFlSyxLQUFmLENBQWhCO0FBQ0FtQixTQUFHaEIsSUFBSCxDQUFRRCxPQUFSO0FBQ0Q7QUFDRCxTQUFLLElBQUlGLFFBQVEsQ0FBakIsRUFBb0JBLFFBQVEsS0FBS0osU0FBTCxDQUFlSyxNQUEzQyxFQUFtREQsT0FBbkQsRUFBNEQ7QUFDMUQsWUFBTUUsVUFBVSxLQUFLTixTQUFMLENBQWVJLEtBQWYsQ0FBaEI7QUFDQW1CLFNBQUdoQixJQUFILENBQVFELE9BQVI7QUFDRDtBQUNELFNBQUssSUFBSUYsUUFBUSxDQUFqQixFQUFvQkEsUUFBUWtCLE1BQU1qQixNQUFsQyxFQUEwQ0QsT0FBMUMsRUFBbUQ7QUFDakQsWUFBTW9CLE9BQU9GLE1BQU1sQixLQUFOLENBQWI7QUFDQSxVQUFJLENBQUNSLHFCQUFVaUIsUUFBVixDQUFtQlUsRUFBbkIsRUFBdUJDLElBQXZCLENBQUwsRUFDRSxLQUFLeEIsU0FBTCxDQUFlTyxJQUFmLENBQW9CaUIsSUFBcEI7QUFDSDtBQUNGOztBQUVEQyxXQUFTO0FBQ1AsV0FBTztBQUNMOUIsVUFBSSxLQUFLQSxFQUFMLENBQVFhLEdBQVIsRUFEQztBQUVMVixZQUFNLEtBQUtBLElBQUwsQ0FBVVUsR0FBVixFQUZEO0FBR0xULGlCQUFXLEtBQUtHLGVBQUwsRUFITjtBQUlMRixpQkFBVyxLQUFLUyxlQUFMLEVBSk47QUFLTFIsa0JBQVksS0FBS0EsVUFBTCxDQUFnQk8sR0FBaEI7QUFMUCxLQUFQO0FBT0Q7O0FBRURrQixRQUFNQyxVQUFOLEVBQWtCQyxVQUFsQixFQUE4QjtBQUM1QixXQUFPLEtBQUs5QixJQUFMLEdBQVksR0FBWixHQUFrQixLQUFLSCxFQUFMLENBQVFhLEdBQVIsRUFBbEIsR0FBa0MsR0FBbEMsR0FBd0MsR0FBeEMsR0FBOEMsR0FBOUMsR0FBb0RtQixVQUFwRCxHQUNMLEdBREssR0FDQ0MsVUFERCxHQUNjLElBRHJCO0FBRUQ7QUFoSDBEOztrQkFBeEM1QyxjO0FBbUhyQlAsV0FBV29ELGVBQVgsQ0FBMkIsQ0FBQzdDLGNBQUQsQ0FBM0IiLCJmaWxlIjoiU3BpbmFsUmVsYXRpb24uanMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBzcGluYWxDb3JlID0gcmVxdWlyZShcInNwaW5hbC1jb3JlLWNvbm5lY3RvcmpzXCIpO1xuY29uc3QgZ2xvYmFsVHlwZSA9IHR5cGVvZiB3aW5kb3cgPT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWwgOiB3aW5kb3c7XG5sZXQgZ2V0Vmlld2VyID0gZnVuY3Rpb24oKSB7XG4gIHJldHVybiBnbG9iYWxUeXBlLnY7XG59O1xuXG5pbXBvcnQge1xuICBVdGlsaXRpZXNcbn0gZnJvbSBcIi4vVXRpbGl0aWVzXCJcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgU3BpbmFsUmVsYXRpb24gZXh0ZW5kcyBnbG9iYWxUeXBlLk1vZGVsIHtcbiAgY29uc3RydWN0b3IoX3R5cGUsIF9ub2RlTGlzdDEsIF9ub2RlTGlzdDIsIF9pc0RpcmVjdGVkLCBuYW1lID1cbiAgICBcIlNwaW5hbFJlbGF0aW9uXCIpIHtcbiAgICBzdXBlcigpO1xuICAgIGlmIChGaWxlU3lzdGVtLl9zaWdfc2VydmVyKSB7XG4gICAgICB0aGlzLmFkZF9hdHRyKHtcbiAgICAgICAgaWQ6IFV0aWxpdGllcy5ndWlkKHRoaXMuY29uc3RydWN0b3IubmFtZSksXG4gICAgICAgIHR5cGU6IF90eXBlLFxuICAgICAgICBub2RlTGlzdDE6IF9ub2RlTGlzdDEsXG4gICAgICAgIG5vZGVMaXN0MjogX25vZGVMaXN0MixcbiAgICAgICAgaXNEaXJlY3RlZDogX2lzRGlyZWN0ZWQgfHwgZmFsc2VcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIGdldE5vZGVMaXN0MUlkcygpIHtcbiAgICBsZXQgdCA9IFtdXG4gICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IHRoaXMubm9kZUxpc3QxLmxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgY29uc3QgZWxlbWVudCA9IHRoaXMubm9kZUxpc3QxW2luZGV4XTtcbiAgICAgIHQucHVzaChlbGVtZW50LmlkLmdldCgpKVxuICAgIH1cbiAgICByZXR1cm4gdFxuICB9XG5cbiAgZ2V0Tm9kZUxpc3QySWRzKCkge1xuICAgIGxldCB0ID0gW11cbiAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgdGhpcy5ub2RlTGlzdDIubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICBjb25zdCBlbGVtZW50ID0gdGhpcy5ub2RlTGlzdDJbaW5kZXhdO1xuICAgICAgdC5wdXNoKGVsZW1lbnQuaWQuZ2V0KCkpXG4gICAgfVxuICAgIHJldHVybiB0XG4gIH1cblxuICBnZXROb2RlTGlzdDFMaXN0MklkcygpIHtcbiAgICBsZXQgdCA9IFtdXG4gICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IHRoaXMubm9kZUxpc3QxLmxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgY29uc3QgZWxlbWVudCA9IHRoaXMubm9kZUxpc3QxW2luZGV4XTtcbiAgICAgIHQucHVzaChlbGVtZW50LmlkLmdldCgpKVxuICAgIH1cbiAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgdGhpcy5ub2RlTGlzdDIubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICBjb25zdCBlbGVtZW50ID0gdGhpcy5ub2RlTGlzdDJbaW5kZXhdO1xuICAgICAgdC5wdXNoKGVsZW1lbnQuaWQuZ2V0KCkpXG4gICAgfVxuICAgIHJldHVybiB0XG4gIH1cblxuICBhZGROb3RFeGlzdGluZ05vZGV0b05vZGVMaXN0MShfbm9kZSkge1xuICAgIGlmICghVXRpbGl0aWVzLmNvbnRhaW5zKHRoaXMubm9kZUxpc3QxLCBfbm9kZSkpXG4gICAgICB0aGlzLm5vZGVMaXN0MS5wdXNoKF9ub2RlKVxuICB9XG5cbiAgYWRkTm90RXhpc3RpbmdOb2Rlc3RvTm9kZUxpc3QxKF9ub2Rlcykge1xuICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBfbm9kZXMubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICBjb25zdCBlbGVtZW50ID0gX25vZGVzW2luZGV4XTtcbiAgICAgIHRoaXMuYWRkTm90RXhpc3RpbmdOb2RldG9Ob2RlTGlzdDEoZWxlbWVudClcbiAgICB9XG4gIH1cblxuICBhZGROb3RFeGlzdGluZ05vZGV0b05vZGVMaXN0Mihfbm9kZSkge1xuICAgIGlmICghVXRpbGl0aWVzLmNvbnRhaW5zKHRoaXMubm9kZUxpc3QyLCBfbm9kZSkpXG4gICAgICB0aGlzLm5vZGVMaXN0Mi5wdXNoKF9ub2RlKVxuICB9XG5cbiAgYWRkTm90RXhpc3RpbmdOb2Rlc3RvTm9kZUxpc3QyKF9ub2Rlcykge1xuICAgIGNvbnNvbGUubG9nKF9ub2Rlcyk7XG5cbiAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgX25vZGVzLmxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgY29uc3QgZWxlbWVudCA9IF9ub2Rlc1tpbmRleF07XG4gICAgICB0aGlzLmFkZE5vdEV4aXN0aW5nTm9kZXRvTm9kZUxpc3QyKGVsZW1lbnQpXG4gICAgfVxuICB9XG5cbiAgYWRkTm90RXhpc3RpbmdOb2RldG9SZWxhdGlvbihfcmVsYXRpb24pIHtcbiAgICBvdGhlciA9IFtdXG4gICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IF9yZWxhdGlvbi5ub2RlTGlzdDEubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICBjb25zdCBlbGVtZW50ID0gX3JlbGF0aW9uLm5vZGVMaXN0MVtpbmRleF07XG4gICAgICBvdGhlci5wdXNoKGVsZW1lbnQpXG4gICAgfVxuICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBfcmVsYXRpb24ubm9kZUxpc3QyLmxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgY29uc3QgZWxlbWVudCA9IF9yZWxhdGlvbi5ub2RlTGlzdDJbaW5kZXhdO1xuICAgICAgb3RoZXIucHVzaChlbGVtZW50KVxuICAgIH1cblxuICAgIG1lID0gW11cbiAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgdGhpcy5ub2RlTGlzdDEubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICBjb25zdCBlbGVtZW50ID0gdGhpcy5ub2RlTGlzdDFbaW5kZXhdO1xuICAgICAgbWUucHVzaChlbGVtZW50KVxuICAgIH1cbiAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgdGhpcy5ub2RlTGlzdDIubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICBjb25zdCBlbGVtZW50ID0gdGhpcy5ub2RlTGlzdDJbaW5kZXhdO1xuICAgICAgbWUucHVzaChlbGVtZW50KVxuICAgIH1cbiAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgb3RoZXIubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICBjb25zdCBub2RlID0gb3RoZXJbaW5kZXhdXG4gICAgICBpZiAoIVV0aWxpdGllcy5jb250YWlucyhtZSwgbm9kZSkpXG4gICAgICAgIHRoaXMubm9kZUxpc3QyLnB1c2gobm9kZSlcbiAgICB9XG4gIH1cblxuICB0b0pzb24oKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGlkOiB0aGlzLmlkLmdldCgpLFxuICAgICAgdHlwZTogdGhpcy50eXBlLmdldCgpLFxuICAgICAgbm9kZUxpc3QxOiB0aGlzLmdldE5vZGVMaXN0MUlkcygpLFxuICAgICAgbm9kZUxpc3QyOiB0aGlzLmdldE5vZGVMaXN0MklkcygpLFxuICAgICAgaXNEaXJlY3RlZDogdGhpcy5pc0RpcmVjdGVkLmdldCgpXG4gICAgfVxuICB9XG5cbiAgdG9JZmMoZWxlbWVudDFJZCwgZWxlbWVudDJJZCkge1xuICAgIHJldHVybiB0aGlzLnR5cGUgKyAnKCcgKyB0aGlzLmlkLmdldCgpICsgJywnICsgJyQnICsgJyQnICsgZWxlbWVudDFJZCArXG4gICAgICAnLCcgKyBlbGVtZW50MklkICsgJyk7J1xuICB9XG59XG5cbnNwaW5hbENvcmUucmVnaXN0ZXJfbW9kZWxzKFtTcGluYWxSZWxhdGlvbl0pOyJdfQ==