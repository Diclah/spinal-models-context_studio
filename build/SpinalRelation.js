"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _Utilities = require("./Utilities");

const spinalCore = require("spinal-core-connectorjs");
const globalType = typeof window === "undefined" ? global : window;
let getViewer = function () {
  return globalType.v;
};

class SpinalRelation extends globalType.Model {
  constructor(_type, _nodeList1, _nodeList2, _isDirected, name = "SpinalRelation") {
    super();
    if (FileSystem._sig_server) {
      this.add_attr({
        id: _Utilities.Utilities.guid(this.constructor.name),
        type: _type,
        nodeList1: _nodeList1,
        nodeList2: _nodeList2,
        isDirected: _isDirected || false
      });
    }
  }

  getNodeList1() {
    return this.nodeList1;
  }

  getNodeList2() {
    return this.nodeList2;
  }
  getNodeList1Ids() {
    let t = [];
    for (let index = 0; index < this.nodeList1.length; index++) {
      const element = this.nodeList1[index];
      t.push(element.id.get());
    }
    return t;
  }

  getNodeList2Ids() {
    let t = [];
    for (let index = 0; index < this.nodeList2.length; index++) {
      const element = this.nodeList2[index];
      t.push(element.id.get());
    }
    return t;
  }

  getNodeList1List2Ids() {
    let t = [];
    for (let index = 0; index < this.nodeList1.length; index++) {
      const element = this.nodeList1[index];
      t.push(element.id.get());
    }
    for (let index = 0; index < this.nodeList2.length; index++) {
      const element = this.nodeList2[index];
      t.push(element.id.get());
    }
    return t;
  }

  addNotExistingNodetoNodeList1(_node) {
    if (!_Utilities.Utilities.containsLstById(this.nodeList1, _node)) this.nodeList1.push(_node);
  }

  addNodetoNodeList1(_node) {
    this.nodeList1.push(_node);
  }

  addNotExistingNodestoNodeList1(_nodes) {
    for (let index = 0; index < _nodes.length; index++) {
      const element = _nodes[index];
      this.addNotExistingNodetoNodeList1(element);
    }
  }

  addNodetoNodeList2(_node) {
    this.nodeList2.push(_node);
  }

  addNotExistingNodetoNodeList2(_node) {
    if (!_Utilities.Utilities.containsLstById(this.nodeList2, _node)) this.nodeList2.push(_node);
  }

  addNotExistingNodestoNodeList2(_nodes) {
    console.log(_nodes);

    for (let index = 0; index < _nodes.length; index++) {
      const element = _nodes[index];
      this.addNotExistingNodetoNodeList2(element);
    }
  }

  addNotExistingNodetoRelation(_relation) {
    other = [];
    for (let index = 0; index < _relation.nodeList1.length; index++) {
      const element = _relation.nodeList1[index];
      other.push(element);
    }
    for (let index = 0; index < _relation.nodeList2.length; index++) {
      const element = _relation.nodeList2[index];
      other.push(element);
    }

    me = [];
    for (let index = 0; index < this.nodeList1.length; index++) {
      const element = this.nodeList1[index];
      me.push(element);
    }
    for (let index = 0; index < this.nodeList2.length; index++) {
      const element = this.nodeList2[index];
      me.push(element);
    }
    for (let index = 0; index < other.length; index++) {
      const node = other[index];
      if (!_Utilities.Utilities.containsLstById(me, node)) this.nodeList2.push(node);
    }
  }

  toJson() {
    return {
      id: this.id.get(),
      type: this.type.get(),
      nodeList1: this.getNodeList1Ids(),
      nodeList2: this.getNodeList2Ids(),
      isDirected: this.isDirected.get()
    };
  }

  toIfc(element1Id, element2Id) {
    return this.type + "(" + this.id.get() + "," + "$" + "$" + element1Id + "," + element2Id + ");";
  }
}

exports.default = SpinalRelation;
spinalCore.register_models([SpinalRelation]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9TcGluYWxSZWxhdGlvbi5qcyJdLCJuYW1lcyI6WyJzcGluYWxDb3JlIiwicmVxdWlyZSIsImdsb2JhbFR5cGUiLCJ3aW5kb3ciLCJnbG9iYWwiLCJnZXRWaWV3ZXIiLCJ2IiwiU3BpbmFsUmVsYXRpb24iLCJNb2RlbCIsImNvbnN0cnVjdG9yIiwiX3R5cGUiLCJfbm9kZUxpc3QxIiwiX25vZGVMaXN0MiIsIl9pc0RpcmVjdGVkIiwibmFtZSIsIkZpbGVTeXN0ZW0iLCJfc2lnX3NlcnZlciIsImFkZF9hdHRyIiwiaWQiLCJVdGlsaXRpZXMiLCJndWlkIiwidHlwZSIsIm5vZGVMaXN0MSIsIm5vZGVMaXN0MiIsImlzRGlyZWN0ZWQiLCJnZXROb2RlTGlzdDEiLCJnZXROb2RlTGlzdDIiLCJnZXROb2RlTGlzdDFJZHMiLCJ0IiwiaW5kZXgiLCJsZW5ndGgiLCJlbGVtZW50IiwicHVzaCIsImdldCIsImdldE5vZGVMaXN0MklkcyIsImdldE5vZGVMaXN0MUxpc3QySWRzIiwiYWRkTm90RXhpc3RpbmdOb2RldG9Ob2RlTGlzdDEiLCJfbm9kZSIsImNvbnRhaW5zTHN0QnlJZCIsImFkZE5vZGV0b05vZGVMaXN0MSIsImFkZE5vdEV4aXN0aW5nTm9kZXN0b05vZGVMaXN0MSIsIl9ub2RlcyIsImFkZE5vZGV0b05vZGVMaXN0MiIsImFkZE5vdEV4aXN0aW5nTm9kZXRvTm9kZUxpc3QyIiwiYWRkTm90RXhpc3RpbmdOb2Rlc3RvTm9kZUxpc3QyIiwiY29uc29sZSIsImxvZyIsImFkZE5vdEV4aXN0aW5nTm9kZXRvUmVsYXRpb24iLCJfcmVsYXRpb24iLCJvdGhlciIsIm1lIiwibm9kZSIsInRvSnNvbiIsInRvSWZjIiwiZWxlbWVudDFJZCIsImVsZW1lbnQySWQiLCJyZWdpc3Rlcl9tb2RlbHMiXSwibWFwcGluZ3MiOiI7Ozs7OztBQU1BOztBQU5BLE1BQU1BLGFBQWFDLFFBQVEseUJBQVIsQ0FBbkI7QUFDQSxNQUFNQyxhQUFhLE9BQU9DLE1BQVAsS0FB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bGF0aW9uLmpzIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3Qgc3BpbmFsQ29yZSA9IHJlcXVpcmUoXCJzcGluYWwtY29yZS1jb25uZWN0b3Jqc1wiKTtcbmNvbnN0IGdsb2JhbFR5cGUgPSB0eXBlb2Ygd2luZG93ID09PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsIDogd2luZG93O1xubGV0IGdldFZpZXdlciA9IGZ1bmN0aW9uKCkge1xuICByZXR1cm4gZ2xvYmFsVHlwZS52O1xufTtcblxuaW1wb3J0IHsgVXRpbGl0aWVzIH0gZnJvbSBcIi4vVXRpbGl0aWVzXCI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFNwaW5hbFJlbGF0aW9uIGV4dGVuZHMgZ2xvYmFsVHlwZS5Nb2RlbCB7XG4gIGNvbnN0cnVjdG9yKFxuICAgIF90eXBlLFxuICAgIF9ub2RlTGlzdDEsXG4gICAgX25vZGVMaXN0MixcbiAgICBfaXNEaXJlY3RlZCxcbiAgICBuYW1lID0gXCJTcGluYWxSZWxhdGlvblwiXG4gICkge1xuICAgIHN1cGVyKCk7XG4gICAgaWYgKEZpbGVTeXN0ZW0uX3NpZ19zZXJ2ZXIpIHtcbiAgICAgIHRoaXMuYWRkX2F0dHIoe1xuICAgICAgICBpZDogVXRpbGl0aWVzLmd1aWQodGhpcy5jb25zdHJ1Y3Rvci5uYW1lKSxcbiAgICAgICAgdHlwZTogX3R5cGUsXG4gICAgICAgIG5vZGVMaXN0MTogX25vZGVMaXN0MSxcbiAgICAgICAgbm9kZUxpc3QyOiBfbm9kZUxpc3QyLFxuICAgICAgICBpc0RpcmVjdGVkOiBfaXNEaXJlY3RlZCB8fCBmYWxzZVxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgZ2V0Tm9kZUxpc3QxKCkge1xuICAgIHJldHVybiB0aGlzLm5vZGVMaXN0MTtcbiAgfVxuXG4gIGdldE5vZGVMaXN0MigpIHtcbiAgICByZXR1cm4gdGhpcy5ub2RlTGlzdDI7XG4gIH1cbiAgZ2V0Tm9kZUxpc3QxSWRzKCkge1xuICAgIGxldCB0ID0gW107XG4gICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IHRoaXMubm9kZUxpc3QxLmxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgY29uc3QgZWxlbWVudCA9IHRoaXMubm9kZUxpc3QxW2luZGV4XTtcbiAgICAgIHQucHVzaChlbGVtZW50LmlkLmdldCgpKTtcbiAgICB9XG4gICAgcmV0dXJuIHQ7XG4gIH1cblxuICBnZXROb2RlTGlzdDJJZHMoKSB7XG4gICAgbGV0IHQgPSBbXTtcbiAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgdGhpcy5ub2RlTGlzdDIubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICBjb25zdCBlbGVtZW50ID0gdGhpcy5ub2RlTGlzdDJbaW5kZXhdO1xuICAgICAgdC5wdXNoKGVsZW1lbnQuaWQuZ2V0KCkpO1xuICAgIH1cbiAgICByZXR1cm4gdDtcbiAgfVxuXG4gIGdldE5vZGVMaXN0MUxpc3QySWRzKCkge1xuICAgIGxldCB0ID0gW107XG4gICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IHRoaXMubm9kZUxpc3QxLmxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgY29uc3QgZWxlbWVudCA9IHRoaXMubm9kZUxpc3QxW2luZGV4XTtcbiAgICAgIHQucHVzaChlbGVtZW50LmlkLmdldCgpKTtcbiAgICB9XG4gICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IHRoaXMubm9kZUxpc3QyLmxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgY29uc3QgZWxlbWVudCA9IHRoaXMubm9kZUxpc3QyW2luZGV4XTtcbiAgICAgIHQucHVzaChlbGVtZW50LmlkLmdldCgpKTtcbiAgICB9XG4gICAgcmV0dXJuIHQ7XG4gIH1cblxuICBhZGROb3RFeGlzdGluZ05vZGV0b05vZGVMaXN0MShfbm9kZSkge1xuICAgIGlmICghVXRpbGl0aWVzLmNvbnRhaW5zTHN0QnlJZCh0aGlzLm5vZGVMaXN0MSwgX25vZGUpKVxuICAgICAgdGhpcy5ub2RlTGlzdDEucHVzaChfbm9kZSk7XG4gIH1cblxuICBhZGROb2RldG9Ob2RlTGlzdDEoX25vZGUpIHtcbiAgICB0aGlzLm5vZGVMaXN0MS5wdXNoKF9ub2RlKTtcbiAgfVxuXG4gIGFkZE5vdEV4aXN0aW5nTm9kZXN0b05vZGVMaXN0MShfbm9kZXMpIHtcbiAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgX25vZGVzLmxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgY29uc3QgZWxlbWVudCA9IF9ub2Rlc1tpbmRleF07XG4gICAgICB0aGlzLmFkZE5vdEV4aXN0aW5nTm9kZXRvTm9kZUxpc3QxKGVsZW1lbnQpO1xuICAgIH1cbiAgfVxuXG4gIGFkZE5vZGV0b05vZGVMaXN0Mihfbm9kZSkge1xuICAgIHRoaXMubm9kZUxpc3QyLnB1c2goX25vZGUpO1xuICB9XG5cbiAgYWRkTm90RXhpc3RpbmdOb2RldG9Ob2RlTGlzdDIoX25vZGUpIHtcbiAgICBpZiAoIVV0aWxpdGllcy5jb250YWluc0xzdEJ5SWQodGhpcy5ub2RlTGlzdDIsIF9ub2RlKSlcbiAgICAgIHRoaXMubm9kZUxpc3QyLnB1c2goX25vZGUpO1xuICB9XG5cbiAgYWRkTm90RXhpc3RpbmdOb2Rlc3RvTm9kZUxpc3QyKF9ub2Rlcykge1xuICAgIGNvbnNvbGUubG9nKF9ub2Rlcyk7XG5cbiAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgX25vZGVzLmxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgY29uc3QgZWxlbWVudCA9IF9ub2Rlc1tpbmRleF07XG4gICAgICB0aGlzLmFkZE5vdEV4aXN0aW5nTm9kZXRvTm9kZUxpc3QyKGVsZW1lbnQpO1xuICAgIH1cbiAgfVxuXG4gIGFkZE5vdEV4aXN0aW5nTm9kZXRvUmVsYXRpb24oX3JlbGF0aW9uKSB7XG4gICAgb3RoZXIgPSBbXTtcbiAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgX3JlbGF0aW9uLm5vZGVMaXN0MS5sZW5ndGg7IGluZGV4KyspIHtcbiAgICAgIGNvbnN0IGVsZW1lbnQgPSBfcmVsYXRpb24ubm9kZUxpc3QxW2luZGV4XTtcbiAgICAgIG90aGVyLnB1c2goZWxlbWVudCk7XG4gICAgfVxuICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBfcmVsYXRpb24ubm9kZUxpc3QyLmxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgY29uc3QgZWxlbWVudCA9IF9yZWxhdGlvbi5ub2RlTGlzdDJbaW5kZXhdO1xuICAgICAgb3RoZXIucHVzaChlbGVtZW50KTtcbiAgICB9XG5cbiAgICBtZSA9IFtdO1xuICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCB0aGlzLm5vZGVMaXN0MS5sZW5ndGg7IGluZGV4KyspIHtcbiAgICAgIGNvbnN0IGVsZW1lbnQgPSB0aGlzLm5vZGVMaXN0MVtpbmRleF07XG4gICAgICBtZS5wdXNoKGVsZW1lbnQpO1xuICAgIH1cbiAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgdGhpcy5ub2RlTGlzdDIubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICBjb25zdCBlbGVtZW50ID0gdGhpcy5ub2RlTGlzdDJbaW5kZXhdO1xuICAgICAgbWUucHVzaChlbGVtZW50KTtcbiAgICB9XG4gICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IG90aGVyLmxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgY29uc3Qgbm9kZSA9IG90aGVyW2luZGV4XTtcbiAgICAgIGlmICghVXRpbGl0aWVzLmNvbnRhaW5zTHN0QnlJZChtZSwgbm9kZSkpIHRoaXMubm9kZUxpc3QyLnB1c2gobm9kZSk7XG4gICAgfVxuICB9XG5cbiAgdG9Kc29uKCkge1xuICAgIHJldHVybiB7XG4gICAgICBpZDogdGhpcy5pZC5nZXQoKSxcbiAgICAgIHR5cGU6IHRoaXMudHlwZS5nZXQoKSxcbiAgICAgIG5vZGVMaXN0MTogdGhpcy5nZXROb2RlTGlzdDFJZHMoKSxcbiAgICAgIG5vZGVMaXN0MjogdGhpcy5nZXROb2RlTGlzdDJJZHMoKSxcbiAgICAgIGlzRGlyZWN0ZWQ6IHRoaXMuaXNEaXJlY3RlZC5nZXQoKVxuICAgIH07XG4gIH1cblxuICB0b0lmYyhlbGVtZW50MUlkLCBlbGVtZW50MklkKSB7XG4gICAgcmV0dXJuIChcbiAgICAgIHRoaXMudHlwZSArXG4gICAgICBcIihcIiArXG4gICAgICB0aGlzLmlkLmdldCgpICtcbiAgICAgIFwiLFwiICtcbiAgICAgIFwiJFwiICtcbiAgICAgIFwiJFwiICtcbiAgICAgIGVsZW1lbnQxSWQgK1xuICAgICAgXCIsXCIgK1xuICAgICAgZWxlbWVudDJJZCArXG4gICAgICBcIik7XCJcbiAgICApO1xuICB9XG59XG5cbnNwaW5hbENvcmUucmVnaXN0ZXJfbW9kZWxzKFtTcGluYWxSZWxhdGlvbl0pO1xuIl19