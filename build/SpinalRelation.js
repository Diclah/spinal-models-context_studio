"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _Utilities = require("./Utilities");

const spinalCore = require("spinal-core-connectorjs");
const globalType = typeof window === "undefined" ? global : window;
let getViewer = function () {
  return globalType.v;
};

class SpinalRelation extends globalType.Model {
  constructor(type, nodeList1, nodeList2, isDirected,
  // _name = "",
  name = "SpinalRelation") {
    super();
    if (FileSystem._sig_server) {
      this.add_attr({
        id: _Utilities.Utilities.guid(this.constructor.name),
        type: type,
        nodeList1: nodeList1,
        nodeList2: nodeList2,
        isDirected: isDirected || false
        // name: _name
      });
    }
  }

  getNodeList1() {
    return this.nodeList1;
  }

  getNodeList2() {
    return this.nodeList2;
  }
  getNodeList1Ids() {
    let t = [];
    for (let index = 0; index < this.nodeList1.length; index++) {
      const element = this.nodeList1[index];
      t.push(element.id.get());
    }
    return t;
  }

  getNodeList2Ids() {
    let t = [];
    for (let index = 0; index < this.nodeList2.length; index++) {
      const element = this.nodeList2[index];
      t.push(element.id.get());
    }
    return t;
  }

  getNodeList1List2Ids() {
    let t = [];
    for (let index = 0; index < this.nodeList1.length; index++) {
      const element = this.nodeList1[index];
      t.push(element.id.get());
    }
    for (let index = 0; index < this.nodeList2.length; index++) {
      const element = this.nodeList2[index];
      t.push(element.id.get());
    }
    return t;
  }

  addNotExistingNodetoNodeList1(_node) {
    if (!_Utilities.Utilities.containsLstById(this.nodeList1, _node)) this.nodeList1.push(_node);
  }

  addNodetoNodeList1(_node) {
    this.nodeList1.push(_node);
  }

  addNotExistingNodestoNodeList1(_nodes) {
    for (let index = 0; index < _nodes.length; index++) {
      const element = _nodes[index];
      this.addNotExistingNodetoNodeList1(element);
    }
  }

  addNodetoNodeList2(_node) {
    this.nodeList2.push(_node);
  }

  addNotExistingNodetoNodeList2(_node) {
    if (!_Utilities.Utilities.containsLstById(this.nodeList2, _node)) this.nodeList2.push(_node);
  }

  addNotExistingNodestoNodeList2(_nodes) {
    console.log(_nodes);

    for (let index = 0; index < _nodes.length; index++) {
      const element = _nodes[index];
      this.addNotExistingNodetoNodeList2(element);
    }
  }

  addNotExistingNodetoRelation(_relation) {
    let other = [];
    for (let index = 0; index < _relation.nodeList1.length; index++) {
      const element = _relation.nodeList1[index];
      other.push(element);
    }
    for (let index = 0; index < _relation.nodeList2.length; index++) {
      const element = _relation.nodeList2[index];
      other.push(element);
    }

    let me = [];
    for (let index = 0; index < this.nodeList1.length; index++) {
      const element = this.nodeList1[index];
      me.push(element);
    }
    for (let index = 0; index < this.nodeList2.length; index++) {
      const element = this.nodeList2[index];
      me.push(element);
    }
    for (let index = 0; index < other.length; index++) {
      const node = other[index];
      if (!_Utilities.Utilities.containsLstById(me, node)) this.nodeList2.push(node);
    }
  }

  removeFromNodeList2(node) {
    for (let index = 0; index < this.nodeList2.length; index++) {
      const candidateNode = this.nodeList2[index];
      if (node.id.get() === candidateNode.id.get()) {
        this.nodeList2.splice(index, 1);
        return;
      }
    }
  }

  toJson() {
    return {
      id: this.id.get(),
      type: this.type.get(),
      nodeList1: this.getNodeList1Ids(),
      nodeList2: this.getNodeList2Ids(),
      isDirected: this.isDirected.get()
    };
  }

  toIfc(element1Id, element2Id) {
    return this.type + "(" + this.id.get() + "," + "$" + "$" + element1Id + "," + element2Id + ");";
  }
}

exports.default = SpinalRelation;
spinalCore.register_models([SpinalRelation]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9TcGluYWxSZWxhdGlvbi5qcyJdLCJuYW1lcyI6WyJzcGluYWxDb3JlIiwicmVxdWlyZSIsImdsb2JhbFR5cGUiLCJ3aW5kb3ciLCJnbG9iYWwiLCJnZXRWaWV3ZXIiLCJ2IiwiU3BpbmFsUmVsYXRpb24iLCJNb2RlbCIsImNvbnN0cnVjdG9yIiwidHlwZSIsIm5vZGVMaXN0MSIsIm5vZGVMaXN0MiIsImlzRGlyZWN0ZWQiLCJuYW1lIiwiRmlsZVN5c3RlbSIsIl9zaWdfc2VydmVyIiwiYWRkX2F0dHIiLCJpZCIsIlV0aWxpdGllcyIsImd1aWQiLCJnZXROb2RlTGlzdDEiLCJnZXROb2RlTGlzdDIiLCJnZXROb2RlTGlzdDFJZHMiLCJ0IiwiaW5kZXgiLCJsZW5ndGgiLCJlbGVtZW50IiwicHVzaCIsImdldCIsImdldE5vZGVMaXN0MklkcyIsImdldE5vZGVMaXN0MUxpc3QySWRzIiwiYWRkTm90RXhpc3RpbmdOb2RldG9Ob2RlTGlzdDEiLCJfbm9kZSIsImNvbnRhaW5zTHN0QnlJZCIsImFkZE5vZGV0b05vZGVMaXN0MSIsImFkZE5vdEV4aXN0aW5nTm9kZXN0b05vZGVMaXN0MSIsIl9ub2RlcyIsImFkZE5vZGV0b05vZGVMaXN0MiIsImFkZE5vdEV4aXN0aW5nTm9kZXRvTm9kZUxpc3QyIiwiYWRkTm90RXhpc3RpbmdOb2Rlc3RvTm9kZUxpc3QyIiwiY29uc29sZSIsImxvZyIsImFkZE5vdEV4aXN0aW5nTm9kZXRvUmVsYXRpb24iLCJfcmVsYXRpb24iLCJvdGhlciIsIm1lIiwibm9kZSIsInJlbW92ZUZyb21Ob2RlTGlzdDIiLCJjYW5kaWRhdGVOb2RlIiwic3BsaWNlIiwidG9Kc29uIiwidG9JZmMiLCJlbGVtZW50MUlkIiwiZWxlbWVudDJJZCIsInJlZ2lzdGVyX21vZGVscyJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBTUE7O0FBTkEsTUFBTUEsYUFBYUMsUUFBUSx5QkFBUixDQUFuQjtBQUNBLE1BQU1DLGFBQWEsT0FBT0MsTUFBUCxLQUFr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QUFMLEVBSE47QUFJTFgsaUJBQVcsS0FBS2tCLGVBQUwsRUFKTjtBQUtMakIsa0JBQVksS0FBS0EsVUFBTCxDQUFnQmdCLEdBQWhCO0FBTFAsS0FBUDtBQU9EOztBQUVEdUIsUUFBTUMsVUFBTixFQUFrQkMsVUFBbEIsRUFBOEI7QUFDNUIsV0FDRSxLQUFLNUMsSUFBTCxHQUNBLEdBREEsR0FFQSxLQUFLUSxFQUFMLENBQVFXLEdBQVIsRUFGQSxHQUdBLEdBSEEsR0FJQSxHQUpBLEdBS0EsR0FMQSxHQU1Bd0IsVUFOQSxHQU9BLEdBUEEsR0FRQUMsVUFSQSxHQVNBLElBVkY7QUFZRDtBQXpKMEQ7O2tCQUF4Qy9DLGM7QUE0SnJCUCxXQUFXdUQsZUFBWCxDQUEyQixDQUFDaEQsY0FBRCxDQUEzQiIsImZpbGUiOiJTcGluYWxSZWxhdGlvbi5qcyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHNwaW5hbENvcmUgPSByZXF1aXJlKFwic3BpbmFsLWNvcmUtY29ubmVjdG9yanNcIik7XG5jb25zdCBnbG9iYWxUeXBlID0gdHlwZW9mIHdpbmRvdyA9PT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbCA6IHdpbmRvdztcbmxldCBnZXRWaWV3ZXIgPSBmdW5jdGlvbigpIHtcbiAgcmV0dXJuIGdsb2JhbFR5cGUudjtcbn07XG5cbmltcG9ydCB7IFV0aWxpdGllcyB9IGZyb20gXCIuL1V0aWxpdGllc1wiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTcGluYWxSZWxhdGlvbiBleHRlbmRzIGdsb2JhbFR5cGUuTW9kZWwge1xuICBjb25zdHJ1Y3RvcihcbiAgICB0eXBlLFxuICAgIG5vZGVMaXN0MSxcbiAgICBub2RlTGlzdDIsXG4gICAgaXNEaXJlY3RlZCxcbiAgICAvLyBfbmFtZSA9IFwiXCIsXG4gICAgbmFtZSA9IFwiU3BpbmFsUmVsYXRpb25cIlxuICApIHtcbiAgICBzdXBlcigpO1xuICAgIGlmIChGaWxlU3lzdGVtLl9zaWdfc2VydmVyKSB7XG4gICAgICB0aGlzLmFkZF9hdHRyKHtcbiAgICAgICAgaWQ6IFV0aWxpdGllcy5ndWlkKHRoaXMuY29uc3RydWN0b3IubmFtZSksXG4gICAgICAgIHR5cGU6IHR5cGUsXG4gICAgICAgIG5vZGVMaXN0MTogbm9kZUxpc3QxLFxuICAgICAgICBub2RlTGlzdDI6IG5vZGVMaXN0MixcbiAgICAgICAgaXNEaXJlY3RlZDogaXNEaXJlY3RlZCB8fCBmYWxzZVxuICAgICAgICAvLyBuYW1lOiBfbmFtZVxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgZ2V0Tm9kZUxpc3QxKCkge1xuICAgIHJldHVybiB0aGlzLm5vZGVMaXN0MTtcbiAgfVxuXG4gIGdldE5vZGVMaXN0MigpIHtcbiAgICByZXR1cm4gdGhpcy5ub2RlTGlzdDI7XG4gIH1cbiAgZ2V0Tm9kZUxpc3QxSWRzKCkge1xuICAgIGxldCB0ID0gW107XG4gICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IHRoaXMubm9kZUxpc3QxLmxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgY29uc3QgZWxlbWVudCA9IHRoaXMubm9kZUxpc3QxW2luZGV4XTtcbiAgICAgIHQucHVzaChlbGVtZW50LmlkLmdldCgpKTtcbiAgICB9XG4gICAgcmV0dXJuIHQ7XG4gIH1cblxuICBnZXROb2RlTGlzdDJJZHMoKSB7XG4gICAgbGV0IHQgPSBbXTtcbiAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgdGhpcy5ub2RlTGlzdDIubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICBjb25zdCBlbGVtZW50ID0gdGhpcy5ub2RlTGlzdDJbaW5kZXhdO1xuICAgICAgdC5wdXNoKGVsZW1lbnQuaWQuZ2V0KCkpO1xuICAgIH1cbiAgICByZXR1cm4gdDtcbiAgfVxuXG4gIGdldE5vZGVMaXN0MUxpc3QySWRzKCkge1xuICAgIGxldCB0ID0gW107XG4gICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IHRoaXMubm9kZUxpc3QxLmxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgY29uc3QgZWxlbWVudCA9IHRoaXMubm9kZUxpc3QxW2luZGV4XTtcbiAgICAgIHQucHVzaChlbGVtZW50LmlkLmdldCgpKTtcbiAgICB9XG4gICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IHRoaXMubm9kZUxpc3QyLmxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgY29uc3QgZWxlbWVudCA9IHRoaXMubm9kZUxpc3QyW2luZGV4XTtcbiAgICAgIHQucHVzaChlbGVtZW50LmlkLmdldCgpKTtcbiAgICB9XG4gICAgcmV0dXJuIHQ7XG4gIH1cblxuICBhZGROb3RFeGlzdGluZ05vZGV0b05vZGVMaXN0MShfbm9kZSkge1xuICAgIGlmICghVXRpbGl0aWVzLmNvbnRhaW5zTHN0QnlJZCh0aGlzLm5vZGVMaXN0MSwgX25vZGUpKVxuICAgICAgdGhpcy5ub2RlTGlzdDEucHVzaChfbm9kZSk7XG4gIH1cblxuICBhZGROb2RldG9Ob2RlTGlzdDEoX25vZGUpIHtcbiAgICB0aGlzLm5vZGVMaXN0MS5wdXNoKF9ub2RlKTtcbiAgfVxuXG4gIGFkZE5vdEV4aXN0aW5nTm9kZXN0b05vZGVMaXN0MShfbm9kZXMpIHtcbiAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgX25vZGVzLmxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgY29uc3QgZWxlbWVudCA9IF9ub2Rlc1tpbmRleF07XG4gICAgICB0aGlzLmFkZE5vdEV4aXN0aW5nTm9kZXRvTm9kZUxpc3QxKGVsZW1lbnQpO1xuICAgIH1cbiAgfVxuXG4gIGFkZE5vZGV0b05vZGVMaXN0Mihfbm9kZSkge1xuICAgIHRoaXMubm9kZUxpc3QyLnB1c2goX25vZGUpO1xuICB9XG5cbiAgYWRkTm90RXhpc3RpbmdOb2RldG9Ob2RlTGlzdDIoX25vZGUpIHtcbiAgICBpZiAoIVV0aWxpdGllcy5jb250YWluc0xzdEJ5SWQodGhpcy5ub2RlTGlzdDIsIF9ub2RlKSlcbiAgICAgIHRoaXMubm9kZUxpc3QyLnB1c2goX25vZGUpO1xuICB9XG5cbiAgYWRkTm90RXhpc3RpbmdOb2Rlc3RvTm9kZUxpc3QyKF9ub2Rlcykge1xuICAgIGNvbnNvbGUubG9nKF9ub2Rlcyk7XG5cbiAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgX25vZGVzLmxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgY29uc3QgZWxlbWVudCA9IF9ub2Rlc1tpbmRleF07XG4gICAgICB0aGlzLmFkZE5vdEV4aXN0aW5nTm9kZXRvTm9kZUxpc3QyKGVsZW1lbnQpO1xuICAgIH1cbiAgfVxuXG4gIGFkZE5vdEV4aXN0aW5nTm9kZXRvUmVsYXRpb24oX3JlbGF0aW9uKSB7XG4gICAgbGV0IG90aGVyID0gW107XG4gICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IF9yZWxhdGlvbi5ub2RlTGlzdDEubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICBjb25zdCBlbGVtZW50ID0gX3JlbGF0aW9uLm5vZGVMaXN0MVtpbmRleF07XG4gICAgICBvdGhlci5wdXNoKGVsZW1lbnQpO1xuICAgIH1cbiAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgX3JlbGF0aW9uLm5vZGVMaXN0Mi5sZW5ndGg7IGluZGV4KyspIHtcbiAgICAgIGNvbnN0IGVsZW1lbnQgPSBfcmVsYXRpb24ubm9kZUxpc3QyW2luZGV4XTtcbiAgICAgIG90aGVyLnB1c2goZWxlbWVudCk7XG4gICAgfVxuXG4gICAgbGV0IG1lID0gW107XG4gICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IHRoaXMubm9kZUxpc3QxLmxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgY29uc3QgZWxlbWVudCA9IHRoaXMubm9kZUxpc3QxW2luZGV4XTtcbiAgICAgIG1lLnB1c2goZWxlbWVudCk7XG4gICAgfVxuICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCB0aGlzLm5vZGVMaXN0Mi5sZW5ndGg7IGluZGV4KyspIHtcbiAgICAgIGNvbnN0IGVsZW1lbnQgPSB0aGlzLm5vZGVMaXN0MltpbmRleF07XG4gICAgICBtZS5wdXNoKGVsZW1lbnQpO1xuICAgIH1cbiAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgb3RoZXIubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICBjb25zdCBub2RlID0gb3RoZXJbaW5kZXhdO1xuICAgICAgaWYgKCFVdGlsaXRpZXMuY29udGFpbnNMc3RCeUlkKG1lLCBub2RlKSkgdGhpcy5ub2RlTGlzdDIucHVzaChub2RlKTtcbiAgICB9XG4gIH1cblxuICByZW1vdmVGcm9tTm9kZUxpc3QyKG5vZGUpIHtcbiAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgdGhpcy5ub2RlTGlzdDIubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICBjb25zdCBjYW5kaWRhdGVOb2RlID0gdGhpcy5ub2RlTGlzdDJbaW5kZXhdO1xuICAgICAgaWYgKG5vZGUuaWQuZ2V0KCkgPT09IGNhbmRpZGF0ZU5vZGUuaWQuZ2V0KCkpIHtcbiAgICAgICAgdGhpcy5ub2RlTGlzdDIuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHRvSnNvbigpIHtcbiAgICByZXR1cm4ge1xuICAgICAgaWQ6IHRoaXMuaWQuZ2V0KCksXG4gICAgICB0eXBlOiB0aGlzLnR5cGUuZ2V0KCksXG4gICAgICBub2RlTGlzdDE6IHRoaXMuZ2V0Tm9kZUxpc3QxSWRzKCksXG4gICAgICBub2RlTGlzdDI6IHRoaXMuZ2V0Tm9kZUxpc3QySWRzKCksXG4gICAgICBpc0RpcmVjdGVkOiB0aGlzLmlzRGlyZWN0ZWQuZ2V0KClcbiAgICB9O1xuICB9XG5cbiAgdG9JZmMoZWxlbWVudDFJZCwgZWxlbWVudDJJZCkge1xuICAgIHJldHVybiAoXG4gICAgICB0aGlzLnR5cGUgK1xuICAgICAgXCIoXCIgK1xuICAgICAgdGhpcy5pZC5nZXQoKSArXG4gICAgICBcIixcIiArXG4gICAgICBcIiRcIiArXG4gICAgICBcIiRcIiArXG4gICAgICBlbGVtZW50MUlkICtcbiAgICAgIFwiLFwiICtcbiAgICAgIGVsZW1lbnQySWQgK1xuICAgICAgXCIpO1wiXG4gICAgKTtcbiAgfVxufVxuXG5zcGluYWxDb3JlLnJlZ2lzdGVyX21vZGVscyhbU3BpbmFsUmVsYXRpb25dKTtcbiJdfQ==