"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _Utilities = require("./Utilities");

const spinalCore = require("spinal-core-connectorjs");
const globalType = typeof window === "undefined" ? global : window;
let getViewer = function () {
  return globalType.v;
};

class SpinalRelation extends globalType.Model {
  constructor(type, nodeList1, nodeList2, isDirected,
  // _name = "",
  name = "SpinalRelation") {
    super();
    if (FileSystem._sig_server) {
      this.add_attr({
        id: _Utilities.Utilities.guid(this.constructor.name),
        type: type,
        nodeList1: nodeList1,
        nodeList2: nodeList2,
        isDirected: isDirected || false
        // name: _name
      });
    }
  }

  getNodeList1() {
    return this.nodeList1;
  }

  getNodeList2() {
    return this.nodeList2;
  }
  getNodeList1Ids() {
    let t = [];
    for (let index = 0; index < this.nodeList1.length; index++) {
      const element = this.nodeList1[index];
      t.push(element.id.get());
    }
    return t;
  }

  getNodeList2Ids() {
    let t = [];
    for (let index = 0; index < this.nodeList2.length; index++) {
      const element = this.nodeList2[index];
      t.push(element.id.get());
    }
    return t;
  }

  getNodeList1List2Ids() {
    let t = [];
    for (let index = 0; index < this.nodeList1.length; index++) {
      const element = this.nodeList1[index];
      t.push(element.id.get());
    }
    for (let index = 0; index < this.nodeList2.length; index++) {
      const element = this.nodeList2[index];
      t.push(element.id.get());
    }
    return t;
  }

  addNotExistingNodetoNodeList1(_node) {
    if (!_Utilities.Utilities.containsLstById(this.nodeList1, _node)) this.nodeList1.push(_node);
  }

  addNodetoNodeList1(_node) {
    this.nodeList1.push(_node);
  }

  addNotExistingNodestoNodeList1(_nodes) {
    for (let index = 0; index < _nodes.length; index++) {
      const element = _nodes[index];
      this.addNotExistingNodetoNodeList1(element);
    }
  }

  addNodetoNodeList2(_node) {
    this.nodeList2.push(_node);
  }

  addNotExistingNodetoNodeList2(_node) {
    if (!_Utilities.Utilities.containsLstById(this.nodeList2, _node)) this.nodeList2.push(_node);
  }

  addNotExistingNodestoNodeList2(_nodes) {
    for (let index = 0; index < _nodes.length; index++) {
      const element = _nodes[index];
      this.addNotExistingNodetoNodeList2(element);
    }
  }

  addNotExistingNodetoRelation(_relation) {
    let other = [];
    for (let index = 0; index < _relation.nodeList1.length; index++) {
      const element = _relation.nodeList1[index];
      other.push(element);
    }
    for (let index = 0; index < _relation.nodeList2.length; index++) {
      const element = _relation.nodeList2[index];
      other.push(element);
    }

    let me = [];
    for (let index = 0; index < this.nodeList1.length; index++) {
      const element = this.nodeList1[index];
      me.push(element);
    }
    for (let index = 0; index < this.nodeList2.length; index++) {
      const element = this.nodeList2[index];
      me.push(element);
    }
    for (let index = 0; index < other.length; index++) {
      const node = other[index];
      if (!_Utilities.Utilities.containsLstById(me, node)) this.nodeList2.push(node);
    }
  }

  removeFromNodeList2(node) {
    for (let index = 0; index < this.nodeList2.length; index++) {
      const candidateNode = this.nodeList2[index];
      if (node.id.get() === candidateNode.id.get()) {
        this.nodeList2.splice(index, 1);
        return;
      }
    }
  }

  toJson() {
    return {
      id: this.id.get(),
      type: this.type.get(),
      nodeList1: this.getNodeList1Ids(),
      nodeList2: this.getNodeList2Ids(),
      isDirected: this.isDirected.get()
    };
  }

  toIfc(element1Id, element2Id) {
    return this.type + "(" + this.id.get() + "," + "$" + "$" + element1Id + "," + element2Id + ");";
  }
}

exports.default = SpinalRelation;
spinalCore.register_models([SpinalRelation]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9TcGluYWxSZWxhdGlvbi5qcyJdLCJuYW1lcyI6WyJzcGluYWxDb3JlIiwicmVxdWlyZSIsImdsb2JhbFR5cGUiLCJ3aW5kb3ciLCJnbG9iYWwiLCJnZXRWaWV3ZXIiLCJ2IiwiU3BpbmFsUmVsYXRpb24iLCJNb2RlbCIsImNvbnN0cnVjdG9yIiwidHlwZSIsIm5vZGVMaXN0MSIsIm5vZGVMaXN0MiIsImlzRGlyZWN0ZWQiLCJuYW1lIiwiRmlsZVN5c3RlbSIsIl9zaWdfc2VydmVyIiwiYWRkX2F0dHIiLCJpZCIsIlV0aWxpdGllcyIsImd1aWQiLCJnZXROb2RlTGlzdDEiLCJnZXROb2RlTGlzdDIiLCJnZXROb2RlTGlzdDFJZHMiLCJ0IiwiaW5kZXgiLCJsZW5ndGgiLCJlbGVtZW50IiwicHVzaCIsImdldCIsImdldE5vZGVMaXN0MklkcyIsImdldE5vZGVMaXN0MUxpc3QySWRzIiwiYWRkTm90RXhpc3RpbmdOb2RldG9Ob2RlTGlzdDEiLCJfbm9kZSIsImNvbnRhaW5zTHN0QnlJZCIsImFkZE5vZGV0b05vZGVMaXN0MSIsImFkZE5vdEV4aXN0aW5nTm9kZXN0b05vZGVMaXN0MSIsIl9ub2RlcyIsImFkZE5vZGV0b05vZGVMaXN0MiIsImFkZE5vdEV4aXN0aW5nTm9kZXRvTm9kZUxpc3QyIiwiYWRkTm90RXhpc3RpbmdOb2Rlc3RvTm9kZUxpc3QyIiwiYWRkTm90RXhpc3RpbmdOb2RldG9SZWxhdGlvbiIsIl9yZWxhdGlvbiIsIm90aGVyIiwibWUiLCJub2RlIiwicmVtb3ZlRnJvbU5vZGVMaXN0MiIsImNhbmRpZGF0ZU5vZGUiLCJzcGxpY2UiLCJ0b0pzb24iLCJ0b0lmYyIsImVsZW1lbnQxSWQiLCJlbGVtZW50MklkIiwicmVnaXN0ZXJfbW9kZWxzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFNQTs7QUFOQSxNQUFNQSxhQUFhQyxRQUFRLHlCQUFSLENBQW5CO0FBQ0EsTUFBTUMsYUFBYSxPQUFPQyxNQUFQLEtBQWtCLFdBQWxCLEdBQWdDQyxN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LEtBQUtBLFVBQUwsQ0FBZ0JnQixHQUFoQjtBQUxQLEtBQVA7QUFPRDs7QUFFRHFCLFFBQU1DLFVBQU4sRUFBa0JDLFVBQWxCLEVBQThCO0FBQzVCLFdBQ0UsS0FBSzFDLElBQUwsR0FDQSxHQURBLEdBRUEsS0FBS1EsRUFBTCxDQUFRVyxHQUFSLEVBRkEsR0FHQSxHQUhBLEdBSUEsR0FKQSxHQUtBLEdBTEEsR0FNQXNCLFVBTkEsR0FPQSxHQVBBLEdBUUFDLFVBUkEsR0FTQSxJQVZGO0FBWUQ7QUF2SjBEOztrQkFBeEM3QyxjO0FBMEpyQlAsV0FBV3FELGVBQVgsQ0FBMkIsQ0FBQzlDLGNBQUQsQ0FBM0IiLCJmaWxlIjoiU3BpbmFsUmVsYXRpb24uanMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBzcGluYWxDb3JlID0gcmVxdWlyZShcInNwaW5hbC1jb3JlLWNvbm5lY3RvcmpzXCIpO1xuY29uc3QgZ2xvYmFsVHlwZSA9IHR5cGVvZiB3aW5kb3cgPT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWwgOiB3aW5kb3c7XG5sZXQgZ2V0Vmlld2VyID0gZnVuY3Rpb24oKSB7XG4gIHJldHVybiBnbG9iYWxUeXBlLnY7XG59O1xuXG5pbXBvcnQge1xuICBVdGlsaXRpZXNcbn0gZnJvbSBcIi4vVXRpbGl0aWVzXCI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFNwaW5hbFJlbGF0aW9uIGV4dGVuZHMgZ2xvYmFsVHlwZS5Nb2RlbCB7XG4gIGNvbnN0cnVjdG9yKFxuICAgIHR5cGUsXG4gICAgbm9kZUxpc3QxLFxuICAgIG5vZGVMaXN0MixcbiAgICBpc0RpcmVjdGVkLFxuICAgIC8vIF9uYW1lID0gXCJcIixcbiAgICBuYW1lID0gXCJTcGluYWxSZWxhdGlvblwiXG4gICkge1xuICAgIHN1cGVyKCk7XG4gICAgaWYgKEZpbGVTeXN0ZW0uX3NpZ19zZXJ2ZXIpIHtcbiAgICAgIHRoaXMuYWRkX2F0dHIoe1xuICAgICAgICBpZDogVXRpbGl0aWVzLmd1aWQodGhpcy5jb25zdHJ1Y3Rvci5uYW1lKSxcbiAgICAgICAgdHlwZTogdHlwZSxcbiAgICAgICAgbm9kZUxpc3QxOiBub2RlTGlzdDEsXG4gICAgICAgIG5vZGVMaXN0Mjogbm9kZUxpc3QyLFxuICAgICAgICBpc0RpcmVjdGVkOiBpc0RpcmVjdGVkIHx8IGZhbHNlXG4gICAgICAgIC8vIG5hbWU6IF9uYW1lXG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBnZXROb2RlTGlzdDEoKSB7XG4gICAgcmV0dXJuIHRoaXMubm9kZUxpc3QxO1xuICB9XG5cbiAgZ2V0Tm9kZUxpc3QyKCkge1xuICAgIHJldHVybiB0aGlzLm5vZGVMaXN0MjtcbiAgfVxuICBnZXROb2RlTGlzdDFJZHMoKSB7XG4gICAgbGV0IHQgPSBbXTtcbiAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgdGhpcy5ub2RlTGlzdDEubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICBjb25zdCBlbGVtZW50ID0gdGhpcy5ub2RlTGlzdDFbaW5kZXhdO1xuICAgICAgdC5wdXNoKGVsZW1lbnQuaWQuZ2V0KCkpO1xuICAgIH1cbiAgICByZXR1cm4gdDtcbiAgfVxuXG4gIGdldE5vZGVMaXN0MklkcygpIHtcbiAgICBsZXQgdCA9IFtdO1xuICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCB0aGlzLm5vZGVMaXN0Mi5sZW5ndGg7IGluZGV4KyspIHtcbiAgICAgIGNvbnN0IGVsZW1lbnQgPSB0aGlzLm5vZGVMaXN0MltpbmRleF07XG4gICAgICB0LnB1c2goZWxlbWVudC5pZC5nZXQoKSk7XG4gICAgfVxuICAgIHJldHVybiB0O1xuICB9XG5cbiAgZ2V0Tm9kZUxpc3QxTGlzdDJJZHMoKSB7XG4gICAgbGV0IHQgPSBbXTtcbiAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgdGhpcy5ub2RlTGlzdDEubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICBjb25zdCBlbGVtZW50ID0gdGhpcy5ub2RlTGlzdDFbaW5kZXhdO1xuICAgICAgdC5wdXNoKGVsZW1lbnQuaWQuZ2V0KCkpO1xuICAgIH1cbiAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgdGhpcy5ub2RlTGlzdDIubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICBjb25zdCBlbGVtZW50ID0gdGhpcy5ub2RlTGlzdDJbaW5kZXhdO1xuICAgICAgdC5wdXNoKGVsZW1lbnQuaWQuZ2V0KCkpO1xuICAgIH1cbiAgICByZXR1cm4gdDtcbiAgfVxuXG4gIGFkZE5vdEV4aXN0aW5nTm9kZXRvTm9kZUxpc3QxKF9ub2RlKSB7XG4gICAgaWYgKCFVdGlsaXRpZXMuY29udGFpbnNMc3RCeUlkKHRoaXMubm9kZUxpc3QxLCBfbm9kZSkpXG4gICAgICB0aGlzLm5vZGVMaXN0MS5wdXNoKF9ub2RlKTtcbiAgfVxuXG4gIGFkZE5vZGV0b05vZGVMaXN0MShfbm9kZSkge1xuICAgIHRoaXMubm9kZUxpc3QxLnB1c2goX25vZGUpO1xuICB9XG5cbiAgYWRkTm90RXhpc3RpbmdOb2Rlc3RvTm9kZUxpc3QxKF9ub2Rlcykge1xuICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBfbm9kZXMubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICBjb25zdCBlbGVtZW50ID0gX25vZGVzW2luZGV4XTtcbiAgICAgIHRoaXMuYWRkTm90RXhpc3RpbmdOb2RldG9Ob2RlTGlzdDEoZWxlbWVudCk7XG4gICAgfVxuICB9XG5cbiAgYWRkTm9kZXRvTm9kZUxpc3QyKF9ub2RlKSB7XG4gICAgdGhpcy5ub2RlTGlzdDIucHVzaChfbm9kZSk7XG4gIH1cblxuICBhZGROb3RFeGlzdGluZ05vZGV0b05vZGVMaXN0Mihfbm9kZSkge1xuICAgIGlmICghVXRpbGl0aWVzLmNvbnRhaW5zTHN0QnlJZCh0aGlzLm5vZGVMaXN0MiwgX25vZGUpKVxuICAgICAgdGhpcy5ub2RlTGlzdDIucHVzaChfbm9kZSk7XG4gIH1cblxuICBhZGROb3RFeGlzdGluZ05vZGVzdG9Ob2RlTGlzdDIoX25vZGVzKSB7XG4gICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IF9ub2Rlcy5sZW5ndGg7IGluZGV4KyspIHtcbiAgICAgIGNvbnN0IGVsZW1lbnQgPSBfbm9kZXNbaW5kZXhdO1xuICAgICAgdGhpcy5hZGROb3RFeGlzdGluZ05vZGV0b05vZGVMaXN0MihlbGVtZW50KTtcbiAgICB9XG4gIH1cblxuICBhZGROb3RFeGlzdGluZ05vZGV0b1JlbGF0aW9uKF9yZWxhdGlvbikge1xuICAgIGxldCBvdGhlciA9IFtdO1xuICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBfcmVsYXRpb24ubm9kZUxpc3QxLmxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgY29uc3QgZWxlbWVudCA9IF9yZWxhdGlvbi5ub2RlTGlzdDFbaW5kZXhdO1xuICAgICAgb3RoZXIucHVzaChlbGVtZW50KTtcbiAgICB9XG4gICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IF9yZWxhdGlvbi5ub2RlTGlzdDIubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICBjb25zdCBlbGVtZW50ID0gX3JlbGF0aW9uLm5vZGVMaXN0MltpbmRleF07XG4gICAgICBvdGhlci5wdXNoKGVsZW1lbnQpO1xuICAgIH1cblxuICAgIGxldCBtZSA9IFtdO1xuICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCB0aGlzLm5vZGVMaXN0MS5sZW5ndGg7IGluZGV4KyspIHtcbiAgICAgIGNvbnN0IGVsZW1lbnQgPSB0aGlzLm5vZGVMaXN0MVtpbmRleF07XG4gICAgICBtZS5wdXNoKGVsZW1lbnQpO1xuICAgIH1cbiAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgdGhpcy5ub2RlTGlzdDIubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICBjb25zdCBlbGVtZW50ID0gdGhpcy5ub2RlTGlzdDJbaW5kZXhdO1xuICAgICAgbWUucHVzaChlbGVtZW50KTtcbiAgICB9XG4gICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IG90aGVyLmxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgY29uc3Qgbm9kZSA9IG90aGVyW2luZGV4XTtcbiAgICAgIGlmICghVXRpbGl0aWVzLmNvbnRhaW5zTHN0QnlJZChtZSwgbm9kZSkpIHRoaXMubm9kZUxpc3QyLnB1c2gobm9kZSk7XG4gICAgfVxuICB9XG5cbiAgcmVtb3ZlRnJvbU5vZGVMaXN0Mihub2RlKSB7XG4gICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IHRoaXMubm9kZUxpc3QyLmxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgY29uc3QgY2FuZGlkYXRlTm9kZSA9IHRoaXMubm9kZUxpc3QyW2luZGV4XTtcbiAgICAgIGlmIChub2RlLmlkLmdldCgpID09PSBjYW5kaWRhdGVOb2RlLmlkLmdldCgpKSB7XG4gICAgICAgIHRoaXMubm9kZUxpc3QyLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICB0b0pzb24oKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGlkOiB0aGlzLmlkLmdldCgpLFxuICAgICAgdHlwZTogdGhpcy50eXBlLmdldCgpLFxuICAgICAgbm9kZUxpc3QxOiB0aGlzLmdldE5vZGVMaXN0MUlkcygpLFxuICAgICAgbm9kZUxpc3QyOiB0aGlzLmdldE5vZGVMaXN0MklkcygpLFxuICAgICAgaXNEaXJlY3RlZDogdGhpcy5pc0RpcmVjdGVkLmdldCgpXG4gICAgfTtcbiAgfVxuXG4gIHRvSWZjKGVsZW1lbnQxSWQsIGVsZW1lbnQySWQpIHtcbiAgICByZXR1cm4gKFxuICAgICAgdGhpcy50eXBlICtcbiAgICAgIFwiKFwiICtcbiAgICAgIHRoaXMuaWQuZ2V0KCkgK1xuICAgICAgXCIsXCIgK1xuICAgICAgXCIkXCIgK1xuICAgICAgXCIkXCIgK1xuICAgICAgZWxlbWVudDFJZCArXG4gICAgICBcIixcIiArXG4gICAgICBlbGVtZW50MklkICtcbiAgICAgIFwiKTtcIlxuICAgICk7XG4gIH1cbn1cblxuc3BpbmFsQ29yZS5yZWdpc3Rlcl9tb2RlbHMoW1NwaW5hbFJlbGF0aW9uXSk7Il19