"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _Utilities = require("./Utilities");

const spinalCore = require("spinal-core-connectorjs");
const globalType = typeof window === "undefined" ? global : window;

/**
 *
 *
 * @class SpinalApplication
 * @extends {Model}
 */
class SpinalApplication extends globalType.Model {
  /**
   *Creates an instance of SpinalApplication.
   * @param {string} name
   * @param {string[]} relationsTypesLst
   * @param {SpinalGraph} relatedGraph
   * @param {string} [name="SpinalApplication"]
   * @memberof SpinalApplication
   */
  constructor(_name, relationsTypesLst, relatedGraph, name = "SpinalApplication") {
    super();
    if (FileSystem._sig_server) {
      this.add_attr({
        name: _name,
        type: "",
        relationsTypesLst: relationsTypesLst,
        relationsByType: new Model(),
        realtionsLst: new Lst(),
        relatedGraph: relatedGraph
      });
    }
  }

  reserveUniqueRelationType(relationType) {
    this.relatedGraph.reserveUniqueRelationType(relationType, this);
  }

  addRelationType(relationType) {
    if (!this.relatedGraph.isReserved(relationType)) {
      if (!_Utilities.Utilities.containsLst(this.relationsTypesLst, relationType)) {
        this.relationsTypesLst.push(relationType);
      }
    } else {
      console.log(relationType + " is reserved by " + this.reservedRelationsNames[relationType]);
    }
  }

  getCharacteristicElement() {
    return this.realtionsLst;
  }

  addRelation(relation) {
    if (!this.relatedGraph.isReserved(relation.type.get())) {
      this.addRelationType(relation.type.get());
      if (typeof this.relationsByType[relation.type.get()] === "undefined") {
        let list = new Lst();
        list.push(relation);
        this.relationsByType.add_attr({
          [relation.type.get()]: list
        });
      } else {
        this.relationsByType[relation.type.get()].push(relation);
      }
      this.realtionsLst.push(relation);
    } else {
      console.log(relation.type.get() + " is reserved by " + this.reservedRelationsNames[relation.type.get()]);
    }
  }

  hasRelationType(relationType) {
    if (_Utilities.Utilities.containsLst(this.relationsTypesLst, relationType)) return true;else {
      console.warn(this.name.get() + " has not declared " + relationType + " as one of its relation Types.");
      return false;
    }
  }

  hasRelationTypeDefined(relationType) {
    if (typeof this.relationsByType[relationType] !== "undefined") return true;else {
      console.warn("relation " + relationType + " is not defined for app " + this.name.get());
      return false;
    }
  }

  getRelationsByType(relationType) {
    if (this.hasRelationType(relationType) && this.hasRelationTypeDefined(relationType)) return this.relationsByType[relationType];else return [];
  }

  getRelations() {
    return this.realtionsLst;
  }

  getRelationsByNode(node) {
    if (node.hasAppDefined(this.name.get())) return node.getRelationsByAppName(this.name.get());else return [];
  }

  getRelationsByNodeByType(node, relationType) {
    return node.getRelationsByAppNameByType(this.name.get(), relationType);
  }
  /**
   *returns the nodes of the system such as BIMElementNodes
   , AbstractNodes from Relation NodeList1
   *
   * @memberof SpinalApplication
   */
  getCenralNodes() {
    let res = [];
    for (let i = 0; i < realtionsLst.length; i++) {
      const relation = realtionsLst[i];
      let nodeList1 = relation.getNodeList1();
      for (let j = 0; j < nodeList1.length; j++) {
        const node = nodeList1[j];
        res.push(node);
      }
    }
    return res;
  }
  /**
   *
   *
   * @param {string} relationType
   * @returns
   * @memberof SpinalApplication
   */
  getCenralNodesByRelationType(relationType) {
    let res = [];
    for (let i = 0; i < relationsByType[relationType].length; i++) {
      const relation = relationsByType[relationType][i];
      let nodeList1 = relation.getNodeList1();
      for (let j = 0; j < nodeList1.length; j++) {
        const node = nodeList1[j];
        res.push(node);
      }
    }
    return res;
  }

  /**
   *
   *
   * @returns
   * @memberof SpinalApplication
   */
  async getCenralNodesElements() {
    let res = [];
    let centralNodes = this.getCenralNodes();
    for (let index = 0; index < centralNodes.length; index++) {
      const centralNode = centralNodes[index];
      res.push((await _Utilities.Utilities.promiseLoad(centralNode.element)));
    }
    return;
  }
  /**
   *
   *
   * @param {string} relationType
   * @returns
   * @memberof SpinalApplication
   */
  async getCenralNodesElementsByRelationType(relationType) {
    let res = [];
    let centralNodes = this.getCenralNodesByRelationType(relationType);
    for (let index = 0; index < centralNodes.length; index++) {
      const centralNode = centralNodes[index];
      res.push((await _Utilities.Utilities.promiseLoad(centralNode.element)));
    }
    return;
  }

  /**
   *
   *
   * @param {SpinalNode} node
   * @memberof SpinalApplication
   */
  async getAssociatedElementsByNode(node) {
    let res = [];
    let relations = this.getRelationsByNode(node);
    for (let i = 0; i < relations.length; i++) {
      const relation = relations[i];
      const nodeList2 = relation.getNodeList2();
      for (let j = 0; j < nodeList2.length; j++) {
        const node = nodeList2[j];
        res.push((await _Utilities.Utilities.promiseLoad(node.element)));
      }
    }
    return res;
  }
  /**
   *
   *
   * @param {SpinalNode} node
   * @param {string} relationType
   * @memberof SpinalApplication
   */
  async getAssociatedElementsByNodeByRelationType(node, relationType) {
    let res = [];
    let relations = this.getRelationsByNodeByType(node, relationType);
    for (let i = 0; i < relations.length; i++) {
      const relation = relations[i];
      const nodeList2 = relation.getNodeList2();
      for (let j = 0; j < nodeList2.length; j++) {
        const node = nodeList2[j];
        res.push((await _Utilities.Utilities.promiseLoad(node.element)));
      }
    }
    return res;
  }

}
exports.default = SpinalApplication;

spinalCore.register_models([SpinalApplication]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9TcGluYWxBcHBsaWNhdGlvbi5qcyJdLCJuYW1lcyI6WyJzcGluYWxDb3JlIiwicmVxdWlyZSIsImdsb2JhbFR5cGUiLCJ3aW5kb3ciLCJnbG9iYWwiLCJTcGluYWxBcHBsaWNhdGlvbiIsIk1vZGVsIiwiY29uc3RydWN0b3IiLCJfbmFtZSIsInJlbGF0aW9uc1R5cGVzTHN0IiwicmVsYXRlZEdyYXBoIiwibmFtZSIsIkZpbGVTeXN0ZW0iLCJfc2lnX3NlcnZlciIsImFkZF9hdHRyIiwidHlwZSIsInJlbGF0aW9uc0J5VHlwZSIsInJlYWx0aW9uc0xzdCIsIkxzdCIsInJlc2VydmVVbmlxdWVSZWxhdGlvblR5cGUiLCJyZWxhdGlvblR5cGUiLCJhZGRSZWxhdGlvblR5cGUiLCJpc1Jlc2VydmVkIiwiVXRpbGl0aWVzIiwiY29udGFpbnNMc3QiLCJwdXNoIiwiY29uc29sZSIsImxvZyIsInJlc2VydmVkUmVsYXRpb25zTmFtZXMiLCJnZXRDaGFyYWN0ZXJpc3RpY0VsZW1lbnQiLCJhZGRSZWxhdGlvbiIsInJlbGF0aW9uIiwiZ2V0IiwibGlzdCIsImhhc1JlbGF0aW9uVHlwZSIsIndhcm4iLCJoYXNSZWxhdGlvblR5cGVEZWZpbmVkIiwiZ2V0UmVsYXRpb25zQnlUeXBlIiwiZ2V0UmVsYXRpb25zIiwiZ2V0UmVsYXRpb25zQnlOb2RlIiwibm9kZSIsImhhc0FwcERlZmluZWQiLCJnZXRSZWxhdGlvbnNCeUFwcE5hbWUiLCJnZXRSZWxhdGlvbnNCeU5vZGVCeVR5cGUiLCJnZXRSZWxhdGlvbnNCeUFwcE5hbWVCeVR5cGUiLCJnZXRDZW5yYWxOb2RlcyIsInJlcyIsImkiLCJsZW5ndGgiLCJub2RlTGlzdDEiLCJnZXROb2RlTGlzdDEiLCJqIiwiZ2V0Q2VucmFsTm9kZXNCeVJlbGF0aW9uVHlwZSIsImdldENlbnJhbE5vZGVzRWxlbWVudHMiLCJjZW50cmFsTm9kZXMiLCJpbmRleCIsImNlbnRyYWxOb2RlIiwicHJvbWlzZUxvYWQiLCJlbGVtZW50IiwiZ2V0Q2VucmFsTm9kZXNFbGVtZW50c0J5UmVsYXRpb25UeXBlIiwiZ2V0QXNzb2NpYXRlZEVsZW1lbnRzQnlOb2RlIiwicmVsYXRpb25zIiwibm9kZUxpc3QyIiwiZ2V0Tm9kZUxpc3QyIiwiZ2V0QXNzb2NpYXRlZEVsZW1lbnRzQnlOb2RlQnlSZWxhdGlvblR5cGUiLCJyZWdpc3Rlcl9tb2RlbHMiXSwibWFwcGluZ3MiOiI7Ozs7OztBQUdBOztBQUhBLE1BQU1BLGFBQWFDLFFBQVEseUJBQVIsQ0FBbkI7QUFDQSxNQUFNQyxhQUFhLE9BQU9DLE1BQVAsS0FBa0IsV0FBbEIsR0FBZ0NDLE1BQWhDLEdBQXlDRCxNQUE1RDs7QUFRQTs7Ozs7O0FBTUEsTUFBTUUsaUJBQU4sU0FBZ0NILFdBQVdJLEtBQTNDLENBQWlEO0FBQy9DOzs7Ozs7OztBQVFBQyxjQUFZQyxLQUFaLEVBQW1CQyxpQkFBbkIsRUFBc0NDLFlBQXRDLEVBQW9EQyxPQUNsRCxtQkFERixFQUN1QjtBQUNyQjtBQUNBLFFBQUlDLFdBQVdDLFdBQWYsRUFBNEI7QUFDMUIsV0FBS0MsUUFBTCxDQUFjO0FBQ1pILGNBQU1ILEtBRE07QUFFWk8sY0FBTSxFQUZNO0FBR1pOLDJCQUFtQkEsaUJBSFA7QUFJWk8seUJBQWlCLElBQUlWLEtBQUosRUFKTDtBQUtaVyxzQkFBYyxJQUFJQyxHQUFKLEVBTEY7QUFNWlIsc0JBQWNBO0FBTkYsT0FBZDtBQVFEO0FBQ0Y7O0FBRURTLDRCQUEwQkMsWUFBMUIsRUFBd0M7QUFDdEMsU0FBS1YsWUFBTCxDQUFrQlMseUJBQWxCLENBQTRDQyxZQUE1QyxFQUEwRCxJQUExRDtBQUNEOztBQUlEQyxrQkFBZ0JELFlBQWhCLEVBQThCO0FBQzVCLFFBQUksQ0FBQyxLQUFLVixZQUFMLENBQWtCWSxVQUFsQixDQUE2QkYsWUFBN0IsQ0FBTCxFQUFpRDtBQUMvQyxVQUFJLENBQUNHLHFCQUFVQyxXQUFWLENBQXNCLEtBQUtmLGlCQUEzQixFQUNEVyxZQURDLENBQUwsRUFDbUI7QUFDakIsYUFBS1gsaUJBQUwsQ0FB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O0FBQ0Q7QUFDRDs7Ozs7OztBQU9BLFFBQU1rQix5Q0FBTixDQUFnRHhCLElBQWhELEVBQXNEcEIsWUFBdEQsRUFBb0U7QUFDbEUsUUFBSTBCLE1BQU0sRUFBVjtBQUNBLFFBQUllLFlBQVksS0FBS2xCLHdCQUFMLENBQThCSCxJQUE5QixFQUFvQ3BCLFlBQXBDLENBQWhCO0FBQ0EsU0FBSyxJQUFJMkIsSUFBSSxDQUFiLEVBQWdCQSxJQUFJYyxVQUFVYixNQUE5QixFQUFzQ0QsR0FBdEMsRUFBMkM7QUFDekMsWUFBTWhCLFdBQVc4QixVQUFVZCxDQUFWLENBQWpCO0FBQ0EsWUFBTWUsWUFBWS9CLFNBQVNnQyxZQUFULEVBQWxCO0FBQ0EsV0FBSyxJQUFJWixJQUFJLENBQWIsRUFBZ0JBLElBQUlXLFVBQVVkLE1BQTlCLEVBQXNDRyxHQUF0QyxFQUEyQztBQUN6QyxjQUFNWCxPQUFPc0IsVUFBVVgsQ0FBVixDQUFiO0FBQ0FMLFlBQUlyQixJQUFKLEVBQVMsTUFBTUYscUJBQVVrQyxXQUFWLENBQXNCakIsS0FBS2tCLE9BQTNCLENBQWY7QUFDRDtBQUNGO0FBQ0QsV0FBT1osR0FBUDtBQUNEOztBQWpPOEM7a0JBcU9sQ3pDLGlCOztBQUNmTCxXQUFXaUUsZUFBWCxDQUEyQixDQUFDNUQsaUJBQUQsQ0FBM0IiLCJmaWxlIjoiU3BpbmFsQXBwbGljYXRpb24uanMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBzcGluYWxDb3JlID0gcmVxdWlyZShcInNwaW5hbC1jb3JlLWNvbm5lY3RvcmpzXCIpO1xuY29uc3QgZ2xvYmFsVHlwZSA9IHR5cGVvZiB3aW5kb3cgPT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWwgOiB3aW5kb3c7XG5cbmltcG9ydCB7XG4gIFV0aWxpdGllc1xufSBmcm9tIFwiLi9VdGlsaXRpZXNcIjtcblxuXG5cbi8qKlxuICpcbiAqXG4gKiBAY2xhc3MgU3BpbmFsQXBwbGljYXRpb25cbiAqIEBleHRlbmRzIHtNb2RlbH1cbiAqL1xuY2xhc3MgU3BpbmFsQXBwbGljYXRpb24gZXh0ZW5kcyBnbG9iYWxUeXBlLk1vZGVsIHtcbiAgLyoqXG4gICAqQ3JlYXRlcyBhbiBpbnN0YW5jZSBvZiBTcGluYWxBcHBsaWNhdGlvbi5cbiAgICogQHBhcmFtIHtzdHJpbmd9IG5hbWVcbiAgICogQHBhcmFtIHtzdHJpbmdbXX0gcmVsYXRpb25zVHlwZXNMc3RcbiAgICogQHBhcmFtIHtTcGluYWxHcmFwaH0gcmVsYXRlZEdyYXBoXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBbbmFtZT1cIlNwaW5hbEFwcGxpY2F0aW9uXCJdXG4gICAqIEBtZW1iZXJvZiBTcGluYWxBcHBsaWNhdGlvblxuICAgKi9cbiAgY29uc3RydWN0b3IoX25hbWUsIHJlbGF0aW9uc1R5cGVzTHN0LCByZWxhdGVkR3JhcGgsIG5hbWUgPVxuICAgIFwiU3BpbmFsQXBwbGljYXRpb25cIikge1xuICAgIHN1cGVyKCk7XG4gICAgaWYgKEZpbGVTeXN0ZW0uX3NpZ19zZXJ2ZXIpIHtcbiAgICAgIHRoaXMuYWRkX2F0dHIoe1xuICAgICAgICBuYW1lOiBfbmFtZSxcbiAgICAgICAgdHlwZTogXCJcIixcbiAgICAgICAgcmVsYXRpb25zVHlwZXNMc3Q6IHJlbGF0aW9uc1R5cGVzTHN0LFxuICAgICAgICByZWxhdGlvbnNCeVR5cGU6IG5ldyBNb2RlbCgpLFxuICAgICAgICByZWFsdGlvbnNMc3Q6IG5ldyBMc3QoKSxcbiAgICAgICAgcmVsYXRlZEdyYXBoOiByZWxhdGVkR3JhcGhcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHJlc2VydmVVbmlxdWVSZWxhdGlvblR5cGUocmVsYXRpb25UeXBlKSB7XG4gICAgdGhpcy5yZWxhdGVkR3JhcGgucmVzZXJ2ZVVuaXF1ZVJlbGF0aW9uVHlwZShyZWxhdGlvblR5cGUsIHRoaXMpXG4gIH1cblxuXG5cbiAgYWRkUmVsYXRpb25UeXBlKHJlbGF0aW9uVHlwZSkge1xuICAgIGlmICghdGhpcy5yZWxhdGVkR3JhcGguaXNSZXNlcnZlZChyZWxhdGlvblR5cGUpKSB7XG4gICAgICBpZiAoIVV0aWxpdGllcy5jb250YWluc0xzdCh0aGlzLnJlbGF0aW9uc1R5cGVzTHN0LFxuICAgICAgICAgIHJlbGF0aW9uVHlwZSkpIHtcbiAgICAgICAgdGhpcy5yZWxhdGlvbnNUeXBlc0xzdC5wdXNoKHJlbGF0aW9uVHlwZSk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICByZWxhdGlvblR5cGUgK1xuICAgICAgICBcIiBpcyByZXNlcnZlZCBieSBcIiArXG4gICAgICAgIHRoaXMucmVzZXJ2ZWRSZWxhdGlvbnNOYW1lc1tyZWxhdGlvblR5cGVdXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIGdldENoYXJhY3RlcmlzdGljRWxlbWVudCgpIHtcbiAgICByZXR1cm4gdGhpcy5yZWFsdGlvbnNMc3Q7XG4gIH1cblxuICBhZGRSZWxhdGlvbihyZWxhdGlvbikge1xuICAgIGlmICghdGhpcy5yZWxhdGVkR3JhcGguaXNSZXNlcnZlZChyZWxhdGlvbi50eXBlLmdldCgpKSkge1xuICAgICAgdGhpcy5hZGRSZWxhdGlvblR5cGUocmVsYXRpb24udHlwZS5nZXQoKSk7XG4gICAgICBpZiAodHlwZW9mIHRoaXMucmVsYXRpb25zQnlUeXBlW3JlbGF0aW9uLnR5cGUuZ2V0KCldID09PVxuICAgICAgICBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgIGxldCBsaXN0ID0gbmV3IExzdCgpXG4gICAgICAgIGxpc3QucHVzaChyZWxhdGlvbilcbiAgICAgICAgdGhpcy5yZWxhdGlvbnNCeVR5cGUuYWRkX2F0dHIoe1xuICAgICAgICAgIFtyZWxhdGlvbi50eXBlLmdldCgpXTogbGlzdFxuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMucmVsYXRpb25zQnlUeXBlW3JlbGF0aW9uLnR5cGUuZ2V0KCldLnB1c2gocmVsYXRpb24pXG4gICAgICB9XG4gICAgICB0aGlzLnJlYWx0aW9uc0xzdC5wdXNoKHJlbGF0aW9uKVxuICAgIH0gZWxzZSB7XG4gICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgcmVsYXRpb24udHlwZS5nZXQoKSArXG4gICAgICAgIFwiIGlzIHJlc2VydmVkIGJ5IFwiICtcbiAgICAgICAgdGhpcy5yZXNlcnZlZFJlbGF0aW9uc05hbWVzW3JlbGF0aW9uLnR5cGUuZ2V0KCldXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIGhhc1JlbGF0aW9uVHlwZShyZWxhdGlvblR5cGUpIHtcbiAgICBpZiAoVXRpbGl0aWVzLmNvbnRhaW5zTHN0KHRoaXMucmVsYXRpb25zVHlwZXNMc3QsIHJlbGF0aW9uVHlwZSkpXG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIGVsc2Uge1xuICAgICAgY29uc29sZS53YXJuKHRoaXMubmFtZS5nZXQoKSArIFwiIGhhcyBub3QgZGVjbGFyZWQgXCIgKyByZWxhdGlvblR5cGUgK1xuICAgICAgICBcIiBhcyBvbmUgb2YgaXRzIHJlbGF0aW9uIFR5cGVzLlwiKTtcbiAgICAgIHJldHVybiBmYWxzZVxuICAgIH1cbiAgfVxuXG4gIGhhc1JlbGF0aW9uVHlwZURlZmluZWQocmVsYXRpb25UeXBlKSB7XG4gICAgaWYgKHR5cGVvZiB0aGlzLnJlbGF0aW9uc0J5VHlwZVtyZWxhdGlvblR5cGVdICE9PSBcInVuZGVmaW5lZFwiKVxuICAgICAgcmV0dXJuIHRydWVcbiAgICBlbHNlIHtcbiAgICAgIGNvbnNvbGUud2FybihcInJlbGF0aW9uIFwiICsgcmVsYXRpb25UeXBlICtcbiAgICAgICAgXCIgaXMgbm90IGRlZmluZWQgZm9yIGFwcCBcIiArIHRoaXMubmFtZS5nZXQoKSk7XG4gICAgICByZXR1cm4gZmFsc2VcbiAgICB9XG4gIH1cblxuXG5cbiAgZ2V0UmVsYXRpb25zQnlUeXBlKHJlbGF0aW9uVHlwZSkge1xuICAgIGlmICh0aGlzLmhhc1JlbGF0aW9uVHlwZShyZWxhdGlvblR5cGUpICYmIHRoaXMuaGFzUmVsYXRpb25UeXBlRGVmaW5lZChcbiAgICAgICAgcmVsYXRpb25UeXBlKSlcbiAgICAgIHJldHVybiB0aGlzLnJlbGF0aW9uc0J5VHlwZVtyZWxhdGlvblR5cGVdXG4gICAgZWxzZVxuICAgICAgcmV0dXJuIFtdXG4gIH1cblxuICBnZXRSZWxhdGlvbnMoKSB7XG4gICAgcmV0dXJuIHRoaXMucmVhbHRpb25zTHN0O1xuICB9XG5cbiAgZ2V0UmVsYXRpb25zQnlOb2RlKG5vZGUpIHtcbiAgICBpZiAobm9kZS5oYXNBcHBEZWZpbmVkKHRoaXMubmFtZS5nZXQoKSkpXG4gICAgICByZXR1cm4gbm9kZS5nZXRSZWxhdGlvbnNCeUFwcE5hbWUodGhpcy5uYW1lLmdldCgpKVxuICAgIGVsc2UgcmV0dXJuIFtdXG4gIH1cblxuICBnZXRSZWxhdGlvbnNCeU5vZGVCeVR5cGUobm9kZSwgcmVsYXRpb25UeXBlKSB7XG4gICAgcmV0dXJuIG5vZGUuZ2V0UmVsYXRpb25zQnlBcHBOYW1lQnlUeXBlKHRoaXMubmFtZS5nZXQoKSwgcmVsYXRpb25UeXBlKVxuICB9XG4gIC8qKlxuICAgKnJldHVybnMgdGhlIG5vZGVzIG9mIHRoZSBzeXN0ZW0gc3VjaCBhcyBCSU1FbGVtZW50Tm9kZXNcbiAgICwgQWJzdHJhY3ROb2RlcyBmcm9tIFJlbGF0aW9uIE5vZGVMaXN0MVxuICAgKlxuICAgKiBAbWVtYmVyb2YgU3BpbmFsQXBwbGljYXRpb25cbiAgICovXG4gIGdldENlbnJhbE5vZGVzKCkge1xuICAgIGxldCByZXMgPSDCoCBbXVxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcmVhbHRpb25zTHN0Lmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCByZWxhdGlvbiA9IHJlYWx0aW9uc0xzdFtpXTtcbiAgICAgIGxldCBub2RlTGlzdDEgPSByZWxhdGlvbi5nZXROb2RlTGlzdDEoKVxuICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBub2RlTGlzdDEubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgY29uc3Qgbm9kZSA9IG5vZGVMaXN0MVtqXTtcbiAgICAgICAgcmVzLnB1c2gobm9kZSlcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHJlcztcbiAgfVxuICAvKipcbiAgICpcbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IHJlbGF0aW9uVHlwZVxuICAgKiBAcmV0dXJuc1xuICAgKiBAbWVtYmVyb2YgU3BpbmFsQXBwbGljYXRpb25cbiAgICovXG4gIGdldENlbnJhbE5vZGVzQnlSZWxhdGlvblR5cGUocmVsYXRpb25UeXBlKSB7XG4gICAgbGV0IHJlcyA9IMKgIFtdXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCByZWxhdGlvbnNCeVR5cGVbcmVsYXRpb25UeXBlXS5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgcmVsYXRpb24gPSByZWxhdGlvbnNCeVR5cGVbcmVsYXRpb25UeXBlXVtpXTtcbiAgICAgIGxldCBub2RlTGlzdDEgPSByZWxhdGlvbi5nZXROb2RlTGlzdDEoKVxuICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBub2RlTGlzdDEubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgY29uc3Qgbm9kZSA9IG5vZGVMaXN0MVtqXTtcbiAgICAgICAgcmVzLnB1c2gobm9kZSlcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHJlcztcbiAgfVxuXG5cbiAgLyoqXG4gICAqXG4gICAqXG4gICAqIEByZXR1cm5zXG4gICAqIEBtZW1iZXJvZiBTcGluYWxBcHBsaWNhdGlvblxuICAgKi9cbiAgYXN5bmMgZ2V0Q2VucmFsTm9kZXNFbGVtZW50cygpIHtcbiAgICBsZXQgcmVzID0gwqAgW11cbiAgICBsZXQgY2VudHJhbE5vZGVzID0gdGhpcy5nZXRDZW5yYWxOb2RlcygpXG4gICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IGNlbnRyYWxOb2Rlcy5sZW5ndGg7IGluZGV4KyspIHtcbiAgICAgIGNvbnN0IGNlbnRyYWxOb2RlID0gY2VudHJhbE5vZGVzW2luZGV4XTtcbiAgICAgIHJlcy5wdXNoKGF3YWl0IFV0aWxpdGllcy5wcm9taXNlTG9hZChjZW50cmFsTm9kZS5lbGVtZW50KSlcbiAgICB9XG4gICAgcmV0dXJuO1xuICB9XG4gIC8qKlxuICAgKlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gcmVsYXRpb25UeXBlXG4gICAqIEByZXR1cm5zXG4gICAqIEBtZW1iZXJvZiBTcGluYWxBcHBsaWNhdGlvblxuICAgKi9cbiAgYXN5bmMgZ2V0Q2VucmFsTm9kZXNFbGVtZW50c0J5UmVsYXRpb25UeXBlKHJlbGF0aW9uVHlwZSkge1xuICAgIGxldCByZXMgPSDCoCBbXVxuICAgIGxldCBjZW50cmFsTm9kZXMgPSB0aGlzLmdldENlbnJhbE5vZGVzQnlSZWxhdGlvblR5cGUocmVsYXRpb25UeXBlKVxuICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBjZW50cmFsTm9kZXMubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICBjb25zdCBjZW50cmFsTm9kZSA9IGNlbnRyYWxOb2Rlc1tpbmRleF07XG4gICAgICByZXMucHVzaChhd2FpdCBVdGlsaXRpZXMucHJvbWlzZUxvYWQoY2VudHJhbE5vZGUuZWxlbWVudCkpXG4gICAgfVxuICAgIHJldHVybjtcbiAgfVxuXG5cbiAgLyoqXG4gICAqXG4gICAqXG4gICAqIEBwYXJhbSB7U3BpbmFsTm9kZX0gbm9kZVxuICAgKiBAbWVtYmVyb2YgU3BpbmFsQXBwbGljYXRpb25cbiAgICovXG4gIGFzeW5jIGdldEFzc29jaWF0ZWRFbGVtZW50c0J5Tm9kZShub2RlKSB7XG4gICAgbGV0IHJlcyA9IFtdXG4gICAgbGV0IHJlbGF0aW9ucyA9IHRoaXMuZ2V0UmVsYXRpb25zQnlOb2RlKG5vZGUpO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcmVsYXRpb25zLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCByZWxhdGlvbiA9IHJlbGF0aW9uc1tpXTtcbiAgICAgIGNvbnN0IG5vZGVMaXN0MiA9IHJlbGF0aW9uLmdldE5vZGVMaXN0MigpXG4gICAgICBmb3IgKGxldCBqID0gMDsgaiA8IG5vZGVMaXN0Mi5sZW5ndGg7IGorKykge1xuICAgICAgICBjb25zdCBub2RlID0gbm9kZUxpc3QyW2pdO1xuICAgICAgICByZXMucHVzaChhd2FpdCBVdGlsaXRpZXMucHJvbWlzZUxvYWQobm9kZS5lbGVtZW50KSlcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHJlcztcbiAgfVxuICAvKipcbiAgICpcbiAgICpcbiAgICogQHBhcmFtIHtTcGluYWxOb2RlfSBub2RlXG4gICAqIEBwYXJhbSB7c3RyaW5nfSByZWxhdGlvblR5cGVcbiAgICogQG1lbWJlcm9mIFNwaW5hbEFwcGxpY2F0aW9uXG4gICAqL1xuICBhc3luYyBnZXRBc3NvY2lhdGVkRWxlbWVudHNCeU5vZGVCeVJlbGF0aW9uVHlwZShub2RlLCByZWxhdGlvblR5cGUpIHtcbiAgICBsZXQgcmVzID0gW11cbiAgICBsZXQgcmVsYXRpb25zID0gdGhpcy5nZXRSZWxhdGlvbnNCeU5vZGVCeVR5cGUobm9kZSwgcmVsYXRpb25UeXBlKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHJlbGF0aW9ucy5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgcmVsYXRpb24gPSByZWxhdGlvbnNbaV07XG4gICAgICBjb25zdCBub2RlTGlzdDIgPSByZWxhdGlvbi5nZXROb2RlTGlzdDIoKVxuICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBub2RlTGlzdDIubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgY29uc3Qgbm9kZSA9IG5vZGVMaXN0MltqXTtcbiAgICAgICAgcmVzLnB1c2goYXdhaXQgVXRpbGl0aWVzLnByb21pc2VMb2FkKG5vZGUuZWxlbWVudCkpXG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiByZXM7XG4gIH1cblxuXG59XG5leHBvcnQgZGVmYXVsdCBTcGluYWxBcHBsaWNhdGlvbjtcbnNwaW5hbENvcmUucmVnaXN0ZXJfbW9kZWxzKFtTcGluYWxBcHBsaWNhdGlvbl0pIl19