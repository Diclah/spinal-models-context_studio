"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _Utilities = require("./Utilities");

const spinalCore = require("spinal-core-connectorjs");
const globalType = typeof window === "undefined" ? global : window;

class SpinalApplication extends globalType.Model {
  constructor(_name, relationsTypesLst, relatedGraph, name = "SpinalApplication") {
    super();
    if (FileSystem._sig_server) {
      this.add_attr({
        name: _name,
        relationsTypesLst: relationsTypesLst,
        relationsByType: new Model(),
        realtionsLst: new Lst(),
        relatedGraph: relatedGraph
      });
    }
  }

  reserveUniqueRelationType(relationType) {
    this.relatedGraph.reserveUniqueRelationType(relationType, this);
  }

  addRelationType(relationType) {
    if (!this.relatedGraph.isReserved(relationType)) {
      if (!_Utilities.Utilities.containsLst(this.relationsTypesLst, relationType)) {
        this.relationsTypesLst.push(relationType);
      }
    } else {
      console.log(relationType + " is reserved by " + this.reservedRelationsNames[relationType]);
    }
  }

  getCharacteristicElement() {
    return this.realtionsLst;
  }

  addRelation(relation) {
    if (!this.relatedGraph.isReserved(relation.type.get())) {
      this.addRelationType(relation.type.get());
      if (typeof this.relationsByType[relation.type.get()] === "undefined") {
        let list = new Lst();
        list.push(relation);
        this.relationsByType.add_attr({
          [relation.type.get()]: new Ptr(list)
        });
      } else {
        this.relationsByType[relation.type.get()].load(relationTypeLst => {
          relationTypeLst.push(relation);
        });
      }
      this.realtionsLst.push(relation);
    } else {
      console.log(relation.type.get() + " is reserved by " + this.reservedRelationsNames[relation.type.get()]);
    }
  }

  hasRelationType(relationType) {
    if (_Utilities.Utilities.containsLst(this.relationsTypesLst, relationType)) return true;else {
      console.warn(this.name.get() + " has not declared " + relationType + " as one of its relation Types.");
      return false;
    }
  }

  hasRelationTypeDefined(relationType) {
    if (typeof this.relationsByType[relationType] !== "undefined") return true;else {
      console.warn("relation " + relationType + " is not defined for app " + this.name.get());
      return false;
    }
  }

  async getRelationsByType(relationType) {
    if (this.hasRelationType(relationType) && this.hasRelationTypeDefined(relationType)) return await _Utilities.Utilities.promiseLoad(this.relationsByType[relationType]);else return [];
  }

  getRelationsByNode(node) {
    if (node.hasAppDefined(this.name.get())) return node.getRelationsByAppName(this.name.get());else return [];
  }

  getRelationsByNodeByType(node, relationType) {
    return node.getRelationsByAppNameByType(this.name.get(), relationType);
  }

}
exports.default = SpinalApplication;

spinalCore.register_models([SpinalApplication]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9TcGluYWxBcHBsaWNhdGlvbi5qcyJdLCJuYW1lcyI6WyJzcGluYWxDb3JlIiwicmVxdWlyZSIsImdsb2JhbFR5cGUiLCJ3aW5kb3ciLCJnbG9iYWwiLCJTcGluYWxBcHBsaWNhdGlvbiIsIk1vZGVsIiwiY29uc3RydWN0b3IiLCJfbmFtZSIsInJlbGF0aW9uc1R5cGVzTHN0IiwicmVsYXRlZEdyYXBoIiwibmFtZSIsIkZpbGVTeXN0ZW0iLCJfc2lnX3NlcnZlciIsImFkZF9hdHRyIiwicmVsYXRpb25zQnlUeXBlIiwicmVhbHRpb25zTHN0IiwiTHN0IiwicmVzZXJ2ZVVuaXF1ZVJlbGF0aW9uVHlwZSIsInJlbGF0aW9uVHlwZSIsImFkZFJlbGF0aW9uVHlwZSIsImlzUmVzZXJ2ZWQiLCJVdGlsaXRpZXMiLCJjb250YWluc0xzdCIsInB1c2giLCJjb25zb2xlIiwibG9nIiwicmVzZXJ2ZWRSZWxhdGlvbnNOYW1lcyIsImdldENoYXJhY3RlcmlzdGljRWxlbWVudCIsImFkZFJlbGF0aW9uIiwicmVsYXRpb24iLCJ0eXBlIiwiZ2V0IiwibGlzdCIsIlB0ciIsImxvYWQiLCJyZWxhdGlvblR5cGVMc3QiLCJoYXNSZWxhdGlvblR5cGUiLCJ3YXJuIiwiaGFzUmVsYXRpb25UeXBlRGVmaW5lZCIsImdldFJlbGF0aW9uc0J5VHlwZSIsInByb21pc2VMb2FkIiwiZ2V0UmVsYXRpb25zQnlOb2RlIiwibm9kZSIsImhhc0FwcERlZmluZWQiLCJnZXRSZWxhdGlvbnNCeUFwcE5hbWUiLCJnZXRSZWxhdGlvbnNCeU5vZGVCeVR5cGUiLCJnZXRSZWxhdGlvbnNCeUFwcE5hbWVCeVR5cGUiLCJyZWdpc3Rlcl9tb2RlbHMiXSwibWFwcGluZ3MiOiI7Ozs7OztBQUdBOztBQUhBLE1BQU1BLGFBQWFDLFFBQVEseUJBQVIsQ0FBbkI7QUFDQSxNQUFNQyxhQUFhLE9BQU9DLE1BQVAsS0FBa0IsV0FBbEIsR0FBZ0NDLE1BQWhDLEdBQXlDRCxNQUE1RDs7QUFLQSxNQUFN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TSxjQUFRYSxJQUFSLENBQWEsY0FBY25CLFlBQWQsR0FDWCwwQkFEVyxHQUNrQixLQUFLUixJQUFMLENBQVVxQixHQUFWLEVBRC9CO0FBRUEsYUFBTyxLQUFQO0FBQ0Q7QUFDRjs7QUFJRCxRQUFNUSxrQkFBTixDQUF5QnJCLFlBQXpCLEVBQXVDO0FBQ3JDLFFBQUksS0FBS2tCLGVBQUwsQ0FBcUJsQixZQUFyQixLQUFzQyxLQUFLb0Isc0JBQUwsQ0FDdENwQixZQURzQyxDQUExQyxFQUVFLE9BQU8sTUFBTUcscUJBQVVtQixXQUFWLENBQXNCLEtBQUsxQixlQUFMLENBQXFCSSxZQUFyQixDQUF0QixDQUFiLENBRkYsS0FJRSxPQUFPLEVBQVA7QUFDSDs7QUFFRHVCLHFCQUFtQkMsSUFBbkIsRUFBeUI7QUFDdkIsUUFBSUEsS0FBS0MsYUFBTCxDQUFtQixLQUFLakMsSUFBTCxDQUFVcUIsR0FBVixFQUFuQixDQUFKLEVBQ0UsT0FBT1csS0FBS0UscUJBQUwsQ0FBMkIsS0FBS2xDLElBQUwsQ0FBVXFCLEdBQVYsRUFBM0IsQ0FBUCxDQURGLEtBRUssT0FBTyxFQUFQO0FBQ047O0FBRURjLDJCQUF5QkgsSUFBekIsRUFBK0J4QixZQUEvQixFQUE2QztBQUMzQyxXQUFPd0IsS0FBS0ksMkJBQUwsQ0FBaUMsS0FBS3BDLElBQUwsQ0FBVXFCLEdBQVYsRUFBakMsRUFBa0RiLFlBQWxELENBQVA7QUFDRDs7QUFyRzhDO2tCQXlHbENkLGlCOztBQUNmTCxXQUFXZ0QsZUFBWCxDQUEyQixDQUFDM0MsaUJBQUQsQ0FBM0IiLCJmaWxlIjoiU3BpbmFsQXBwbGljYXRpb24uanMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBzcGluYWxDb3JlID0gcmVxdWlyZShcInNwaW5hbC1jb3JlLWNvbm5lY3RvcmpzXCIpO1xuY29uc3QgZ2xvYmFsVHlwZSA9IHR5cGVvZiB3aW5kb3cgPT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWwgOiB3aW5kb3c7XG5cbmltcG9ydCB7XG4gIFV0aWxpdGllc1xufSBmcm9tIFwiLi9VdGlsaXRpZXNcIjtcbmNsYXNzIFNwaW5hbEFwcGxpY2F0aW9uIGV4dGVuZHMgZ2xvYmFsVHlwZS5Nb2RlbCB7XG4gIGNvbnN0cnVjdG9yKF9uYW1lLCByZWxhdGlvbnNUeXBlc0xzdCwgcmVsYXRlZEdyYXBoLCBuYW1lID1cbiAgICBcIlNwaW5hbEFwcGxpY2F0aW9uXCIpIHtcbiAgICBzdXBlcigpO1xuICAgIGlmIChGaWxlU3lzdGVtLl9zaWdfc2VydmVyKSB7XG4gICAgICB0aGlzLmFkZF9hdHRyKHtcbiAgICAgICAgbmFtZTogX25hbWUsXG4gICAgICAgIHJlbGF0aW9uc1R5cGVzTHN0OiByZWxhdGlvbnNUeXBlc0xzdCxcbiAgICAgICAgcmVsYXRpb25zQnlUeXBlOiBuZXcgTW9kZWwoKSxcbiAgICAgICAgcmVhbHRpb25zTHN0OiBuZXcgTHN0KCksXG4gICAgICAgIHJlbGF0ZWRHcmFwaDogcmVsYXRlZEdyYXBoXG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICByZXNlcnZlVW5pcXVlUmVsYXRpb25UeXBlKHJlbGF0aW9uVHlwZSkge1xuICAgIHRoaXMucmVsYXRlZEdyYXBoLnJlc2VydmVVbmlxdWVSZWxhdGlvblR5cGUocmVsYXRpb25UeXBlLCB0aGlzKVxuICB9XG5cbiAgYWRkUmVsYXRpb25UeXBlKHJlbGF0aW9uVHlwZSkge1xuICAgIGlmICghdGhpcy5yZWxhdGVkR3JhcGguaXNSZXNlcnZlZChyZWxhdGlvblR5cGUpKSB7XG4gICAgICBpZiAoIVV0aWxpdGllcy5jb250YWluc0xzdCh0aGlzLnJlbGF0aW9uc1R5cGVzTHN0LFxuICAgICAgICAgIHJlbGF0aW9uVHlwZSkpIHtcbiAgICAgICAgdGhpcy5yZWxhdGlvbnNUeXBlc0xzdC5wdXNoKHJlbGF0aW9uVHlwZSk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICByZWxhdGlvblR5cGUgK1xuICAgICAgICBcIiBpcyByZXNlcnZlZCBieSBcIiArXG4gICAgICAgIHRoaXMucmVzZXJ2ZWRSZWxhdGlvbnNOYW1lc1tyZWxhdGlvblR5cGVdXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIGdldENoYXJhY3RlcmlzdGljRWxlbWVudCgpIHtcbiAgICByZXR1cm4gdGhpcy5yZWFsdGlvbnNMc3Q7XG4gIH1cblxuICBhZGRSZWxhdGlvbihyZWxhdGlvbikge1xuICAgIGlmICghdGhpcy5yZWxhdGVkR3JhcGguaXNSZXNlcnZlZChyZWxhdGlvbi50eXBlLmdldCgpKSkge1xuICAgICAgdGhpcy5hZGRSZWxhdGlvblR5cGUocmVsYXRpb24udHlwZS5nZXQoKSk7XG4gICAgICBpZiAodHlwZW9mIHRoaXMucmVsYXRpb25zQnlUeXBlW3JlbGF0aW9uLnR5cGUuZ2V0KCldID09PVxuICAgICAgICBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgIGxldCBsaXN0ID0gbmV3IExzdCgpXG4gICAgICAgIGxpc3QucHVzaChyZWxhdGlvbilcbiAgICAgICAgdGhpcy5yZWxhdGlvbnNCeVR5cGUuYWRkX2F0dHIoe1xuICAgICAgICAgIFtyZWxhdGlvbi50eXBlLmdldCgpXTogbmV3IFB0cihsaXN0KVxuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMucmVsYXRpb25zQnlUeXBlW3JlbGF0aW9uLnR5cGUuZ2V0KCldLmxvYWQocmVsYXRpb25UeXBlTHN0ID0+IHtcbiAgICAgICAgICByZWxhdGlvblR5cGVMc3QucHVzaChyZWxhdGlvbilcbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICAgIHRoaXMucmVhbHRpb25zTHN0LnB1c2gocmVsYXRpb24pXG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICByZWxhdGlvbi50eXBlLmdldCgpICtcbiAgICAgICAgXCIgaXMgcmVzZXJ2ZWQgYnkgXCIgK1xuICAgICAgICB0aGlzLnJlc2VydmVkUmVsYXRpb25zTmFtZXNbcmVsYXRpb24udHlwZS5nZXQoKV1cbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgaGFzUmVsYXRpb25UeXBlKHJlbGF0aW9uVHlwZSkge1xuICAgIGlmIChVdGlsaXRpZXMuY29udGFpbnNMc3QodGhpcy5yZWxhdGlvbnNUeXBlc0xzdCwgcmVsYXRpb25UeXBlKSlcbiAgICAgIHJldHVybiB0cnVlXG4gICAgZWxzZSB7XG4gICAgICBjb25zb2xlLndhcm4odGhpcy5uYW1lLmdldCgpICsgXCIgaGFzIG5vdCBkZWNsYXJlZCBcIiArIHJlbGF0aW9uVHlwZSArXG4gICAgICAgIFwiIGFzIG9uZSBvZiBpdHMgcmVsYXRpb24gVHlwZXMuXCIpO1xuICAgICAgcmV0dXJuIGZhbHNlXG4gICAgfVxuICB9XG5cbiAgaGFzUmVsYXRpb25UeXBlRGVmaW5lZChyZWxhdGlvblR5cGUpIHtcbiAgICBpZiAodHlwZW9mIHRoaXMucmVsYXRpb25zQnlUeXBlW3JlbGF0aW9uVHlwZV0gIT09IFwidW5kZWZpbmVkXCIpXG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIGVsc2Uge1xuICAgICAgY29uc29sZS53YXJuKFwicmVsYXRpb24gXCIgKyByZWxhdGlvblR5cGUgK1xuICAgICAgICBcIiBpcyBub3QgZGVmaW5lZCBmb3IgYXBwIFwiICsgdGhpcy5uYW1lLmdldCgpKTtcbiAgICAgIHJldHVybiBmYWxzZVxuICAgIH1cbiAgfVxuXG5cblxuICBhc3luYyBnZXRSZWxhdGlvbnNCeVR5cGUocmVsYXRpb25UeXBlKSB7XG4gICAgaWYgKHRoaXMuaGFzUmVsYXRpb25UeXBlKHJlbGF0aW9uVHlwZSkgJiYgdGhpcy5oYXNSZWxhdGlvblR5cGVEZWZpbmVkKFxuICAgICAgICByZWxhdGlvblR5cGUpKVxuICAgICAgcmV0dXJuIGF3YWl0IFV0aWxpdGllcy5wcm9taXNlTG9hZCh0aGlzLnJlbGF0aW9uc0J5VHlwZVtyZWxhdGlvblR5cGVdKVxuICAgIGVsc2VcbiAgICAgIHJldHVybiBbXVxuICB9XG5cbiAgZ2V0UmVsYXRpb25zQnlOb2RlKG5vZGUpIHtcbiAgICBpZiAobm9kZS5oYXNBcHBEZWZpbmVkKHRoaXMubmFtZS5nZXQoKSkpXG4gICAgICByZXR1cm4gbm9kZS5nZXRSZWxhdGlvbnNCeUFwcE5hbWUodGhpcy5uYW1lLmdldCgpKVxuICAgIGVsc2UgcmV0dXJuIFtdXG4gIH1cblxuICBnZXRSZWxhdGlvbnNCeU5vZGVCeVR5cGUobm9kZSwgcmVsYXRpb25UeXBlKSB7XG4gICAgcmV0dXJuIG5vZGUuZ2V0UmVsYXRpb25zQnlBcHBOYW1lQnlUeXBlKHRoaXMubmFtZS5nZXQoKSwgcmVsYXRpb25UeXBlKVxuICB9XG5cblxufVxuZXhwb3J0IGRlZmF1bHQgU3BpbmFsQXBwbGljYXRpb247XG5zcGluYWxDb3JlLnJlZ2lzdGVyX21vZGVscyhbU3BpbmFsQXBwbGljYXRpb25dKSJdfQ==