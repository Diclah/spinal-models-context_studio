"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _SpinalNode = require("./SpinalNode");

var _SpinalNode2 = _interopRequireDefault(_SpinalNode);

var _SpinalRelation = require("./SpinalRelation");

var _SpinalRelation2 = _interopRequireDefault(_SpinalRelation);

var _AbstractElement = require("./AbstractElement");

var _AbstractElement2 = _interopRequireDefault(_AbstractElement);

var _BIMElement = require("./BIMElement");

var _BIMElement2 = _interopRequireDefault(_BIMElement);

var _Utilities = require("./Utilities");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const spinalCore = require("spinal-core-connectorjs");
const globalType = typeof window === "undefined" ? global : window;
class Graph extends globalType.Model {
  constructor(_name, _startingVertex, name = "Graph") {
    super();
    if (FileSystem._sig_server) {
      this.add_attr({
        name: _name || "",
        externalIdVertexDic: new Model(),
        startingVertex: _startingVertex || new Ptr(0),
        vertexList: new Ptr(new Lst()),
        vertexListByElementType: new Model(),
        relationList: new Ptr(new Lst()),
        relationListByType: new Model()
      });
    }
  }

  init() {
    globalType.spinal.contextStudio = {};
    globalType.spinal.contextStudio.graph = this;
    globalType.spinal.contextStudio.SpinalNode = _SpinalNode2.default;
    globalType.spinal.contextStudio.SpinalRelation = _SpinalRelation2.default;
    globalType.spinal.contextStudio.AbstractElement = _AbstractElement2.default;
    globalType.spinal.contextStudio.BIMElement = _BIMElement2.default;
    globalType.spinal.contextStudio.Utilities = _Utilities.Utilities;
  }

  async getNodeBydbId(_dbId) {
    let _externalId = await _Utilities.Utilities.getExternalId(_dbId);
    return this.externalIdVertexDic[_externalId];
  }

  async getDbIdByNode(_vertex) {
    let element = await _Utilities.Utilities.promiseLoad(_vertex.element);
    if (element instanceof _BIMElement2.default) {
      let _dbId = await _Utilities.Utilities.getDbIdByExternalId(element.id.get());
      return _dbId;
    }
  }

  guid() {
    return this.constructor.name + "-" + this.s4() + this.s4() + "-" + this.s4() + "-" + this.s4() + "-" + this.s4() + "-" + this.s4() + this.s4() + this.s4() + "-" + Date.now().toString(16);
  }

  s4() {
    return Math.floor((1 + Math.random()) * 0x10000).toString(16).substring(1);
  }

  setName(_name) {
    this.name.set(_name);
  }

  setStartingVertex(_startingVertex) {
    this.mod_attr("startingVertex", new Ptr(_startingVertex));
  }

  async _addExternalIdVertexDicEntry(_ElementId, _vertex) {
    let _dbid = _ElementId.get();
    if (typeof _dbid == "number") if (_dbid != 0) {
      let externalId = await _Utilities.Utilities.getExternalId(_dbid);
      if (typeof this.externalIdVertexDic[externalId] === "undefined") this.externalIdVertexDic.add_attr({
        [externalId]: _vertex
      });
      _ElementId.unbind(this._addExternalIdVertexDicEntry.bind(null, _ElementId));
    }
  }

  addVertex(_element) {
    if (_element instanceof _BIMElement2.default && typeof this.externalIdVertexDic[_element.id.get()] !== "undefined") {
      console.log("BIM OBJECT NODE ALREADY EXISTS");
      return this.externalIdVertexDic[_element.id.get()];
    } else {
      let name = "";
      if (typeof _element.name !== "undefined") {
        name = _element.name.get();
      }
      let vertex = new _SpinalNode2.default(name, _element, this);
      return vertex;
    }
  }

  classifyVertex(_vertex) {
    _Utilities.Utilities.promiseLoad(_vertex.element).then(element => {
      _vertex.graph.set(this);
      this.vertexList.load(vertexList => {
        vertexList.push(_vertex);
      });
      let type = element.constructor.name;
      if (typeof element.type != "undefined") {
        type = element.type.get();
      }
      if (this.vertexListByElementType[type]) {
        this.vertexListByElementType[type].load(vertexListOfType => {
          vertexListOfType.push(_vertex);
        });
      } else {
        let vertexListOfType = new Lst();
        vertexListOfType.push(_vertex);
        this.vertexListByElementType.add_attr({
          [type]: new Ptr(vertexListOfType)
        });
      }
      if (element instanceof _BIMElement2.default) {
        let _dbid = element.id.get();
        if (typeof _dbid == "number") if (_dbid != 0) {
          this._addExternalIdVertexDicEntry(element.id, _vertex);
        } else {
          element.id.bind(this._addExternalIdVertexDicEntry.bind(null, element.id, _vertex));
        }
      }
    });
  }

  addVertices(_vertices) {
    for (let index = 0; index < _vertices.length; index++) {
      this.classifyVertex(_vertices[index]);
    }
  }

  addRelation(_relation) {
    for (let index = 0; index < _relation.vertexList1.length; index++) {
      const vertex = _relation.vertexList1[index];
      vertex.addRelation(_relation);
    }
    if (_relation.isDirected.get()) {
      for (let index = 0; index < _relation.vertexList2.length; index++) {
        const vertex = _relation.vertexList2[index];
        vertex.addDirectedRelationChild(_relation);
      }
    } else {
      for (let index = 0; index < _relation.vertexList2.length; index++) {
        const vertex = _relation.vertexList2[index];
        vertex.addRelation(_relation);
      }
    }
    this._classifyRelation(_relation);
  }

  addRelations(_relations) {
    for (let index = 0; index < _relations.length; index++) {
      const relation = _relations[index];
      this.addRelation(relation);
    }
  }

  _classifyRelation(_relation) {
    this.relationList.load(relationList => {
      relationList.push(_relation);
    });
    if (this.relationListByType[_relation.type.get()]) {
      this.relationListByType[_relation.type.get()].load(relationListOfType => {
        relationListOfType.push(_relation);
      });
    } else {
      let relationListOfType = new Lst();
      relationListOfType.push(_relation);
      this.relationListByType.add_attr({
        [_relation.type.get()]: new Ptr(relationListOfType)
      });
    }
  }

  _classifyRelations(_relations) {
    for (let index = 0; index < _relations.length; index++) {
      this.classRelation(_relations[index]);
    }
  }

  _addNotExistingVerticesFromList(_list) {
    this.vertexList.load(vertexList => {
      for (let i = 0; i < _list.length; i++) {
        let vertex = _list[i];
        if (!_Utilities.Utilities.contains(vertexList, vertex)) {
          this.classifyVertex(vertex);
          console.log("test");
        }
      }
    });
  }

  _addNotExistingVerticesFromRelation(_relation) {
    this._addNotExistingVerticesFromList(_relation.vertexList1);
    this._addNotExistingVerticesFromList(_relation.vertexList2);
  }

}

exports.default = Graph;
spinalCore.register_models([Graph]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9HcmFwaC5qcyJdLCJuYW1lcyI6WyJzcGluYWxDb3JlIiwicmVxdWlyZSIsImdsb2JhbFR5cGUiLCJ3aW5kb3ciLCJnbG9iYWwiLCJHcmFwaCIsIk1vZGVsIiwiY29uc3RydWN0b3IiLCJfbmFtZSIsIl9zdGFydGluZ1ZlcnRleCIsIm5hbWUiLCJGaWxlU3lzdGVtIiwiX3NpZ19zZXJ2ZXIiLCJhZGRfYXR0ciIsImV4dGVybmFsSWRWZXJ0ZXhEaWMiLCJzdGFydGluZ1ZlcnRleCIsIlB0ciIsInZlcnRleExpc3QiLCJMc3QiLCJ2ZXJ0ZXhMaXN0QnlFbGVtZW50VHlwZSIsInJlbGF0aW9uTGlzdCIsInJlbGF0aW9uTGlzdEJ5VHlwZSIsImluaXQiLCJzcGluYWwiLCJjb250ZXh0U3R1ZGlvIiwiZ3JhcGgiLCJTcGluYWxOb2RlIiwiU3BpbmFsUmVsYXRpb24iLCJBYnN0cmFjdEVsZW1lbnQiLCJCSU1FbGVtZW50IiwiVXRpbGl0aWVzIiwiZ2V0Tm9kZUJ5ZGJJZCIsIl9kYklkIiwiX2V4dGVybmFsSWQiLCJnZXRFeHRlcm5hbElkIiwiZ2V0RGJJZEJ5Tm9kZSIsIl92ZXJ0ZXgiLCJlbGVtZW50IiwicHJvbWlzZUxvYWQiLCJnZXREYklkQnlFeHRlcm5hbElkIiwiaWQiLCJnZXQiLCJndWlkIiwiczQiLCJEYXRlIiwibm93IiwidG9TdHJpbmciLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJzdWJzdHJpbmciLCJzZXROYW1lIiwic2V0Iiwic2V0U3RhcnRpbmdWZXJ0ZXgiLCJtb2RfYXR0ciIsIl9hZGRFeHRlcm5hbElkVmVydGV4RGljRW50cnkiLCJfRWxlbWVudElkIiwiX2RiaWQiLCJleHRlcm5hbElkIiwidW5iaW5kIiwiYmluZCIsImFkZFZlcnRleCIsIl9lbGVtZW50IiwiY29uc29sZSIsImxvZyIsInZlcnRleCIsImNsYXNzaWZ5VmVydGV4IiwidGhlbiIsImxvYWQiLCJwdXNoIiwidHlwZSIsInZlcnRleExpc3RPZlR5cGUiLCJhZGRWZXJ0aWNlcyIsIl92ZXJ0aWNlcyIsImluZGV4IiwibGVuZ3RoIiwiYWRkUmVsYXRpb24iLCJfcmVsYXRpb24iLCJ2ZXJ0ZXhMaXN0MSIsImlzRGlyZWN0ZWQiLCJ2ZXJ0ZXhMaXN0MiIsImFkZERpcmVjdGVkUmVsYXRpb25DaGlsZCIsIl9jbGFzc2lmeVJlbGF0aW9uIiwiYWRkUmVsYXRpb25zIiwiX3JlbGF0aW9ucyIsInJlbGF0aW9uIiwicmVsYXRpb25MaXN0T2ZUeXBlIiwiX2NsYXNzaWZ5UmVsYXRpb25zIiwiY2xhc3NSZWxhdGlvbiIsIl9hZGROb3RFeGlzdGluZ1ZlcnRpY2VzRnJvbUxpc3QiLCJfbGlzdCIsImkiLCJjb250YWlucyIsIl9hZGROb3RFeGlzdGluZ1ZlcnRpY2VzRnJvbVJlbGF0aW9uIiwicmVnaXN0ZXJfbW9kZWxzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFFQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUdBOzs7O0FBUkEsTUFBTUEsYUFBYUMsUUFBUSx5QkFBUixDQUFuQjtBQUNBLE1BQU1DLGFBQWEsT0FBT0MsTUFBUCxLQUFrQixXQUFsQixHQUFnQ0MsTUFBaEMsR0FBeUNELE1BQTVEO0FBWWUsTUFBTUUsS0FBTixTQUFvQkgsV0FBV0ksS0FBL0IsQ0FBcUM7QUFDbERDLGNBQVlDLEtBQVosRUFBbUJDLGVBQW5CLEVBQW9DQyxPQUFPLE9BQTNDLEVBQW9EO0FBQ2xEO0FBQ0EsUUFBSUMsV0FBV0MsV0FBZixFQUE0QjtBQUMxQixXQUFLQyxRQUFMLENBQWM7QUFDWkgsY0FBTUYsU0FBUyxFQURIO0FBRVpNLDZCQUFxQixJQUFJUixLQUFKLEVBRlQ7QUFHWlMsd0JBQWdCTixtQkFBbUIsSUFBSU8sR0FBSixDQUFRLENBQVIsQ0FIdkI7QUFJWkMsb0JBQVksSUFBSUQsR0FBSixDQUFRLElBQUlFLEdBQUosRUFBUixDQUpBO0FBS1pDLGlDQUF5QixJQUFJYixLQUFKLEVBTGI7QUFNWmMsc0JBQWMsSUFBSUosR0FBSixDQUFRLElBQUlFLEdBQUosRUFBUixDQU5GO0FBT1pHLDRCQUFvQixJQUFJZixLQUFKO0FBUFIsT0FBZDtBQVNEO0FBQ0Y7O0FBRURnQixTQUFPO0FBQ0xwQixlQUFXcUIsTUFBWCxDQUFrQkMsYUFBbEIsR0FBa0MsRUFBbEM7QUFDQXRCLGVBQVdxQixNQUFYLENBQWtCQyxhQUFsQixDQUFnQ0MsS0FBaEMsR0FBd0MsSUFBeEM7QUFDQXZCLGVBQVdxQixNQUFYLENBQWtCQyxhQUFsQixDQUFnQ0UsVUFBaEMsR0FBNkNBLG9CQUE3QztBQUNBeEIsZUFBV3FCLE1BQVgsQ0FBa0JDLGFBQWxCLENBQWdDRyxjQUFoQyxHQUFpREEsd0JBQWpEO0FBQ0F6QixlQUFXcUIsTUFBWCxDQUFrQkMsYUFBbEIsQ0FBZ0NJLGVBQWhDLEdBQWtEQSx5QkFBbEQ7QUFDQTFCLGVBQVdxQixNQUFYLENBQWtCQyxhQUFsQixDQUFnQ0ssVUFBaEMsR0FBNkNBLG9CQUE3QztBQUNBM0IsZUFBV3FCLE1BQVgsQ0FBa0JDLGFBQWxCLENBQWdDTSxTQUFoQyxHQUE0Q0Esb0JBQTVDO0FBQ0Q7O0FBRUQsUUFBTUMsYUFBTixDQUFvQkMsS0FBcEIsRUFBMkI7QUFDekIsUUFBSUMsY0FBYyxNQUFNSCxxQkFBVUksYUFBVixDQUF3QkYsS0FBeEIsQ0FBeEI7QUFDQSxXQUFPLEtBQUtsQixtQkFBTCxDQUF5Qm1CLFdBQXpCLENBQVA7QUFDRDs7QUFFRCxRQUFNRSxhQUFOLENBQW9CQyxPQUFwQixFQUE2QjtBQUMzQixRQUFJQyxVQUFVLE1BQU1QLHFCQUFVUSxXQUFWLENBQXNCRixRQUFRQyxPQUE5QixDQUFwQjtBQUNBLFFBQUlBLG1CQUFtQlIsb0JBQXZCLEVBQW1DO0FBQ2pDLFVBQUlHLFFBQVEsTUFBTUYscUJBQVVTLG1CQUFWLENBQThCRixRQUFRRyxFQUFSLENBQVdDLEdBQVgsRUFBOUIsQ0FBbEI7QUFDQSxhQUFPVCxLQUFQO0FBQ0Q7QUFDRjs7QUFJRFUsU0FBTztBQUNMLFdBQ0UsS0FBS25DLFdBQUwsQ0FBaUJHLElBQWpCLEdBQ0EsR0FEQSxHQUVBLEtBQUtpQyxFQUFMLEVBRkEsR0FHQSxLQUFLQSxFQUFMLEVBSEEsR0FJQSxHQUpBLEdBS0EsS0FBS0EsRUFBTCxFQUxBLEdBTUEsR0FOQSxHQU9BLEtBQUtBLEVBQUwsRUFQQSxHQVFBLEdBUkEsR0FTQSxLQUFLQSxFQUFMLEVBVEEsR0FVQSxHQVZBLEdBV0EsS0FBS0EsRUFBTCxFQVhBLEdBWUEsS0FBS0EsRUFBTCxFQVpBLEdBYUEsS0FBS0EsRUFBTCxFQWJBLEdBY0EsR0FkQSxHQWVBQyxLQUFLQyxHQUFMLEdBQVdDLFFBQVgsQ0FBb0IsRUFBcEIsQ0FoQkY7QUFrQkQ7O0FBRURILE9BQUs7QUFDSCxXQUFPSSxLQUFLQyxLQUFMLENBQVcsQ0FBQyxJQUFJRCxLQUFLRSxNQUFMLEVBQUwsSUFBc0IsT0FBakMsRUFDSkgsUUFESSxDQUNLLEVBREwsRUFFSkksU0FGSSxDQUVNLENBRk4sQ0FBUDtBQUdEOztBQUVEQyxVQUFRM0MsS0FBUixFQUFlO0FBQ2IsU0FBS0UsSUFBTCxDQUFVMEMsR0FBVixDQUFjNUMsS0FBZDtBQUNEOztBQUVENkMsb0JBQWtCNUMsZUFBbEIsRUFBbUM7QUFDakMsU0FBSzZDLFFBQUwsQ0FBYyxnQkFBZCxFQUFnQyxJQUFJdEMsR0FBSixDQUFRUCxlQUFSLENBQWhDO0FBQ0Q7O0FBRUQsUUFBTThDLDRCQUFOLENBQW1DQyxVQUFuQyxFQUErQ3BCLE9BQS9DLEVBQXdEO0FBQ3RELFFBQUlxQixRQUFRRCxXQUFXZixHQUFYLEVBQVo7QUFDQSxRQUFJLE9BQU9nQixLQUFQLElBQWdCLFFBQXBCLEVBQ0UsSUFBSUEsU0FBUyxDQUFiLEVBQWdCO0FBQ2QsVUFBSUMsYUFBYSxNQUFNNUIscUJBQVVJLGFBQVYsQ0FBd0J1QixLQUF4QixDQUF2QjtBQUNBLFVBQUksT0FBTyxLQUFLM0MsbUJBQUwsQ0FBeUI0QyxVQUF6QixDQUFQLEtBQWdELFdBQXBELEVBQ0UsS0FBSzVDLG1CQUFMLENBQXlCRCxRQUF6QixDQUFrQztBQUNoQyxTQUFDNkMsVUFBRCxHQUFjdEI7QUFEa0IsT0FBbEM7QUFHRm9CLGlCQUFXRyxNQUFYLENBQWtCLEtBQUtKLDRCQUFMLENBQWtDSyxJQUFsQyxDQUF1QyxJQUF2QyxFQUNoQkosVUFEZ0IsQ0FBbEI7QUFFRDtBQUNKOztBQUVESyxZQUFVQyxRQUFWLEVBQW9CO0FBQ2xCLFFBQUlBLG9CQUFvQmpDLG9CQUFwQixJQUFrQyxPQUFPLEtBQUtmLG1CQUFMLENBQ3pDZ0QsU0FBU3RCLEVBQVQsQ0FBWUMsR0FBWixFQUR5QyxDQUFQLEtBQ1gsV0FEM0IsRUFDd0M7QUFDdENzQixjQUFRQyxHQUFSLENBQVksZ0NBQVo7QUFDQSxhQUFPLEtBQUtsRCxtQkFBTCxDQUF5QmdELFNBQVN0QixFQUFULENBQVlDLEdBQVosRUFBekIsQ0FBUDtBQUNELEtBSkQsTUFJTztBQUNMLFVBQUkvQixPQUFPLEVBQVg7QUFDQSxVQUFJLE9BQU9vRCxTQUFTcEQsSUFBaEIsS0FBeUIsV0FBN0IsRUFBMEM7QUFDeENBLGVBQU9vRCxTQUFTcEQsSUFBVCxDQUFjK0IsR0FBZCxFQUFQO0FBQ0Q7QUFDRCxVQUFJd0IsU0FBUyxJQUFJdkMsb0JBQUosQ0FBZWhCLElBQWYsRUFBcUJvRCxRQUFyQixFQUErQixJQUEvQixDQUFiO0FBQ0EsYUFBT0csTUFBUDtBQUVEO0FBQ0Y7O0FBRURDLGlCQUFlOUIsT0FBZixFQUF3QjtBQUN0Qk4seUJBQVVRLFdBQVYsQ0FBc0JGLFFBQVFDLE9BQTlCLEVBQXVDOEIsSUFBdkMsQ0FBNEM5QixXQUFXO0FBQ3JERCxjQUFRWCxLQUFSLENBQWMyQixHQUFkLENBQWtCLElBQWxCO0FBQ0EsV0FBS25DLFVBQUwsQ0FBZ0JtRCxJQUFoQixDQUFxQm5ELGNBQWM7QUFDakNBLG1CQUFXb0QsSUFBWCxDQUFnQmpDLE9BQWhCO0FBQ0QsT0FGRDtBQUdBLFVBQUlrQyxPQUFPakMsUUFBUTlCLFdBQVIsQ0FBb0JHLElBQS9CO0FBQ0EsVUFBSSxPQUFPMkIsUUFBUWlDLElBQWYsSUFBdUIsV0FBM0IsRUFBd0M7QUFDdENBLGVBQU9qQyxRQUFRaUMsSUFBUixDQUFhN0IsR0FBYixFQUFQO0FBQ0Q7QUFDRCxVQUFJLEtBQUt0Qix1QkFBTCxDQUE2Qm1ELElBQTdCLENBQUosRUFBd0M7QUFDdEMsYUFBS25ELHVCQUFMLENBQTZCbUQsSUFBN0IsRUFBbUNGLElBQW5DLENBQ0VHLG9CQUFvQjtBQUNsQkEsMkJBQWlCRixJQUFqQixDQUFzQmpDLE9BQXRCO0FBQ0QsU0FISDtBQUlELE9BTEQsTUFLTztBQUNMLFlBQUltQyxtQkFBbUIsSUFBSXJELEdBQUosRUFBdkI7QUFDQXFELHlCQUFpQkYsSUFBakIsQ0FBc0JqQyxPQUF0QjtBQUNBLGFBQUtqQix1QkFBTCxDQUE2Qk4sUUFBN0IsQ0FBc0M7QUFDcEMsV0FBQ3lELElBQUQsR0FBUSxJQUFJdEQsR0FBSixDQUNOdUQsZ0JBRE07QUFENEIsU0FBdEM7QUFJRDtBQUNELFVBQUlsQyxtQkFBbUJSLG9CQUF2QixFQUFtQztBQUNqQyxZQUFJNEIsUUFBUXBCLFFBQVFHLEVBQVIsQ0FBV0MsR0FBWCxFQUFaO0FBQ0EsWUFBSSxPQUFPZ0IsS0FBUCxJQUFnQixRQUFwQixFQUNFLElBQUlBLFNBQVMsQ0FBYixFQUFnQjtBQUNkLGVBQUtGLDRCQUFMLENBQWtDbEIsUUFBUUcsRUFBMUMsRUFBOENKLE9BQTlDO0FBQ0QsU0FGRCxNQUdHO0FBQ0hDLGtCQUFRRyxFQUFSLENBQVdvQixJQUFYLENBQWdCLEtBQUtMLDRCQUFMLENBQWtDSyxJQUFsQyxDQUF1QyxJQUF2QyxFQUNkdkIsUUFBUUcsRUFETSxFQUNGSixPQURFLENBQWhCO0FBRUQ7QUFDRjtBQUNGLEtBakNEO0FBa0NEOztBQUVEb0MsY0FBWUMsU0FBWixFQUF1QjtBQUNyQixTQUFLLElBQUlDLFFBQVEsQ0FBakIsRUFBb0JBLFFBQVFELFVBQVVFLE1BQXRDLEVBQThDRCxPQUE5QyxFQUF1RDtBQUNyRCxXQUFLUixjQUFMLENBQW9CTyxVQUFVQyxLQUFWLENBQXBCO0FBQ0Q7QUFDRjs7QUFFREUsY0FBWUMsU0FBWixFQUF1QjtBQUNyQixTQUFLLElBQUlILFFBQVEsQ0FBakIsRUFBb0JBLFFBQVFHLFVBQVVDLFdBQVYsQ0FBc0JILE1BQWxELEVBQTBERCxPQUExRCxFQUFtRTtBQUNqRSxZQUFNVCxTQUFTWSxVQUFVQyxXQUFWLENBQXNCSixLQUF0QixDQUFmO0FBQ0FULGFBQU9XLFdBQVAsQ0FBbUJDLFNBQW5CO0FBQ0Q7QUFDRCxRQUFJQSxVQUFVRSxVQUFWLENBQXFCdEMsR0FBckIsRUFBSixFQUFnQztBQUM5QixXQUFLLElBQUlpQyxRQUFRLENBQWpCLEVBQW9CQSxRQUFRRyxVQUFVRyxXQUFWLENBQXNCTCxNQUFsRCxFQUEwREQsT0FBMUQsRUFBbUU7QUFDakUsY0FBTVQsU0FBU1ksVUFBVUcsV0FBVixDQUFzQk4sS0FBdEIsQ0FBZjtBQUNBVCxlQUFPZ0Isd0JBQVAsQ0FBZ0NKLFNBQWhDO0FBQ0Q7QUFDRixLQUxELE1BS087QUFDTCxXQUFLLElBQUlILFFBQVEsQ0FBakIsRUFBb0JBLFFBQVFHLFVBQVVHLFdBQVYsQ0FBc0JMLE1BQWxELEVBQTBERCxPQUExRCxFQUFtRTtBQUNqRSxjQUFNVCxTQUFTWSxVQUFVRyxXQUFWLENBQXNCTixLQUF0QixDQUFmO0FBQ0FULGVBQU9XLFdBQVAsQ0FBbUJDLFNBQW5CO0FBQ0Q7QUFDRjtBQUNELFNBQUtLLGlCQUFMLENBQXVCTCxTQUF2QjtBQUNEOztBQUVETSxlQUFhQyxVQUFiLEVBQXlCO0FBQ3ZCLFNBQUssSUFBSVYsUUFBUSxDQUFqQixFQUFvQkEsUUFBUVUsV0FBV1QsTUFBdkMsRUFBK0NELE9BQS9DLEVBQXdEO0FBQ3RELFlBQU1XLFdBQVdELFdBQVdWLEtBQVgsQ0FBakI7QUFDQSxXQUFLRSxXQUFMLENBQWlCUyxRQUFqQjtBQUNEO0FBQ0Y7O0FBSURILG9CQUFrQkwsU0FBbEIsRUFBNkI7QUFDM0IsU0FBS3pELFlBQUwsQ0FBa0JnRCxJQUFsQixDQUF1QmhELGdCQUFnQjtBQUNyQ0EsbUJBQWFpRCxJQUFiLENBQWtCUSxTQUFsQjtBQUNELEtBRkQ7QUFHQSxRQUFJLEtBQUt4RCxrQkFBTCxDQUF3QndELFVBQVVQLElBQVYsQ0FBZTdCLEdBQWYsRUFBeEIsQ0FBSixFQUFtRDtBQUNqRCxXQUFLcEIsa0JBQUwsQ0FBd0J3RCxVQUFVUCxJQUFWLENBQWU3QixHQUFmLEVBQXhCLEVBQThDMkIsSUFBOUMsQ0FDRWtCLHNCQUFzQjtBQUNwQkEsMkJBQW1CakIsSUFBbkIsQ0FBd0JRLFNBQXhCO0FBQ0QsT0FISDtBQUlELEtBTEQsTUFLTztBQUNMLFVBQUlTLHFCQUFxQixJQUFJcEUsR0FBSixFQUF6QjtBQUNBb0UseUJBQW1CakIsSUFBbkIsQ0FBd0JRLFNBQXhCO0FBQ0EsV0FBS3hELGtCQUFMLENBQXdCUixRQUF4QixDQUFpQztBQUMvQixTQUFDZ0UsVUFBVVAsSUFBVixDQUFlN0IsR0FBZixFQUFELEdBQXdCLElBQUl6QixHQUFKLENBQ3RCc0Usa0JBRHNCO0FBRE8sT0FBakM7QUFJRDtBQUNGOztBQUVEQyxxQkFBbUJILFVBQW5CLEVBQStCO0FBQzdCLFNBQUssSUFBSVYsUUFBUSxDQUFqQixFQUFvQkEsUUFBUVUsV0FBV1QsTUFBdkMsRUFBK0NELE9BQS9DLEVBQXdEO0FBQ3RELFdBQUtjLGFBQUwsQ0FBbUJKLFdBQVdWLEtBQVgsQ0FBbkI7QUFDRDtBQUNGOztBQUlEZSxrQ0FBZ0NDLEtBQWhDLEVBQXVDO0FBQ3JDLFNBQUt6RSxVQUFMLENBQWdCbUQsSUFBaEIsQ0FBcUJuRCxjQUFjO0FBQ2pDLFdBQUssSUFBSTBFLElBQUksQ0FBYixFQUFnQkEsSUFBSUQsTUFBTWYsTUFBMUIsRUFBa0NnQixHQUFsQyxFQUF1QztBQUNyQyxZQUFJMUIsU0FBU3lCLE1BQU1DLENBQU4sQ0FBYjtBQUNBLFlBQUksQ0FBQzdELHFCQUFVOEQsUUFBVixDQUFtQjNFLFVBQW5CLEVBQStCZ0QsTUFBL0IsQ0FBTCxFQUE2QztBQUMzQyxlQUFLQyxjQUFMLENBQW9CRCxNQUFwQjtBQUNBRixrQkFBUUMsR0FBUixDQUFZLE1BQVo7QUFDRDtBQUNGO0FBQ0YsS0FSRDtBQVNEOztBQUVENkIsc0NBQW9DaEIsU0FBcEMsRUFBK0M7QUFDN0MsU0FBS1ksK0JBQUwsQ0FBcUNaLFVBQVVDLFdBQS9DO0FBQ0EsU0FBS1csK0JBQUwsQ0FBcUNaLFVBQVVHLFdBQS9DO0FBQ0Q7O0FBM05pRDs7a0JBQS9CM0UsSztBQStOckJMLFdBQVc4RixlQUFYLENBQTJCLENBQUN6RixLQUFELENBQTNCIiwiZmlsZSI6IkdyYXBoLmpzIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3Qgc3BpbmFsQ29yZSA9IHJlcXVpcmUoXCJzcGluYWwtY29yZS1jb25uZWN0b3Jqc1wiKTtcbmNvbnN0IGdsb2JhbFR5cGUgPSB0eXBlb2Ygd2luZG93ID09PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsIDogd2luZG93O1xuaW1wb3J0IFNwaW5hbE5vZGUgZnJvbSBcIi4vU3BpbmFsTm9kZVwiXG5pbXBvcnQgU3BpbmFsUmVsYXRpb24gZnJvbSBcIi4vU3BpbmFsUmVsYXRpb25cIlxuaW1wb3J0IEFic3RyYWN0RWxlbWVudCBmcm9tIFwiLi9BYnN0cmFjdEVsZW1lbnRcIlxuaW1wb3J0IEJJTUVsZW1lbnQgZnJvbSBcIi4vQklNRWxlbWVudFwiXG5cblxuaW1wb3J0IHtcbiAgVXRpbGl0aWVzXG59IGZyb20gXCIuL1V0aWxpdGllc1wiXG5cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgR3JhcGggZXh0ZW5kcyBnbG9iYWxUeXBlLk1vZGVsIHtcbiAgY29uc3RydWN0b3IoX25hbWUsIF9zdGFydGluZ1ZlcnRleCwgbmFtZSA9IFwiR3JhcGhcIikge1xuICAgIHN1cGVyKCk7XG4gICAgaWYgKEZpbGVTeXN0ZW0uX3NpZ19zZXJ2ZXIpIHtcbiAgICAgIHRoaXMuYWRkX2F0dHIoe1xuICAgICAgICBuYW1lOiBfbmFtZSB8fCBcIlwiLFxuICAgICAgICBleHRlcm5hbElkVmVydGV4RGljOiBuZXcgTW9kZWwoKSxcbiAgICAgICAgc3RhcnRpbmdWZXJ0ZXg6IF9zdGFydGluZ1ZlcnRleCB8fCBuZXcgUHRyKDApLFxuICAgICAgICB2ZXJ0ZXhMaXN0OiBuZXcgUHRyKG5ldyBMc3QoKSksXG4gICAgICAgIHZlcnRleExpc3RCeUVsZW1lbnRUeXBlOiBuZXcgTW9kZWwoKSxcbiAgICAgICAgcmVsYXRpb25MaXN0OiBuZXcgUHRyKG5ldyBMc3QoKSksXG4gICAgICAgIHJlbGF0aW9uTGlzdEJ5VHlwZTogbmV3IE1vZGVsKClcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIGluaXQoKSB7XG4gICAgZ2xvYmFsVHlwZS5zcGluYWwuY29udGV4dFN0dWRpbyA9IHt9XG4gICAgZ2xvYmFsVHlwZS5zcGluYWwuY29udGV4dFN0dWRpby5ncmFwaCA9IHRoaXNcbiAgICBnbG9iYWxUeXBlLnNwaW5hbC5jb250ZXh0U3R1ZGlvLlNwaW5hbE5vZGUgPSBTcGluYWxOb2RlXG4gICAgZ2xvYmFsVHlwZS5zcGluYWwuY29udGV4dFN0dWRpby5TcGluYWxSZWxhdGlvbiA9IFNwaW5hbFJlbGF0aW9uXG4gICAgZ2xvYmFsVHlwZS5zcGluYWwuY29udGV4dFN0dWRpby5BYnN0cmFjdEVsZW1lbnQgPSBBYnN0cmFjdEVsZW1lbnRcbiAgICBnbG9iYWxUeXBlLnNwaW5hbC5jb250ZXh0U3R1ZGlvLkJJTUVsZW1lbnQgPSBCSU1FbGVtZW50XG4gICAgZ2xvYmFsVHlwZS5zcGluYWwuY29udGV4dFN0dWRpby5VdGlsaXRpZXMgPSBVdGlsaXRpZXNcbiAgfVxuXG4gIGFzeW5jIGdldE5vZGVCeWRiSWQoX2RiSWQpIHtcbiAgICBsZXQgX2V4dGVybmFsSWQgPSBhd2FpdCBVdGlsaXRpZXMuZ2V0RXh0ZXJuYWxJZChfZGJJZClcbiAgICByZXR1cm4gdGhpcy5leHRlcm5hbElkVmVydGV4RGljW19leHRlcm5hbElkXVxuICB9XG5cbiAgYXN5bmMgZ2V0RGJJZEJ5Tm9kZShfdmVydGV4KSB7XG4gICAgbGV0IGVsZW1lbnQgPSBhd2FpdCBVdGlsaXRpZXMucHJvbWlzZUxvYWQoX3ZlcnRleC5lbGVtZW50KVxuICAgIGlmIChlbGVtZW50IGluc3RhbmNlb2YgQklNRWxlbWVudCkge1xuICAgICAgbGV0IF9kYklkID0gYXdhaXQgVXRpbGl0aWVzLmdldERiSWRCeUV4dGVybmFsSWQoZWxlbWVudC5pZC5nZXQoKSlcbiAgICAgIHJldHVybiBfZGJJZDtcbiAgICB9XG4gIH1cblxuXG5cbiAgZ3VpZCgpIHtcbiAgICByZXR1cm4gKFxuICAgICAgdGhpcy5jb25zdHJ1Y3Rvci5uYW1lICtcbiAgICAgIFwiLVwiICtcbiAgICAgIHRoaXMuczQoKSArXG4gICAgICB0aGlzLnM0KCkgK1xuICAgICAgXCItXCIgK1xuICAgICAgdGhpcy5zNCgpICtcbiAgICAgIFwiLVwiICtcbiAgICAgIHRoaXMuczQoKSArXG4gICAgICBcIi1cIiArXG4gICAgICB0aGlzLnM0KCkgK1xuICAgICAgXCItXCIgK1xuICAgICAgdGhpcy5zNCgpICtcbiAgICAgIHRoaXMuczQoKSArXG4gICAgICB0aGlzLnM0KCkgK1xuICAgICAgXCItXCIgK1xuICAgICAgRGF0ZS5ub3coKS50b1N0cmluZygxNilcbiAgICApO1xuICB9XG5cbiAgczQoKSB7XG4gICAgcmV0dXJuIE1hdGguZmxvb3IoKDEgKyBNYXRoLnJhbmRvbSgpKSAqIDB4MTAwMDApXG4gICAgICAudG9TdHJpbmcoMTYpXG4gICAgICAuc3Vic3RyaW5nKDEpO1xuICB9XG5cbiAgc2V0TmFtZShfbmFtZSkge1xuICAgIHRoaXMubmFtZS5zZXQoX25hbWUpXG4gIH1cblxuICBzZXRTdGFydGluZ1ZlcnRleChfc3RhcnRpbmdWZXJ0ZXgpIHtcbiAgICB0aGlzLm1vZF9hdHRyKFwic3RhcnRpbmdWZXJ0ZXhcIiwgbmV3IFB0cihfc3RhcnRpbmdWZXJ0ZXgpKVxuICB9XG5cbiAgYXN5bmMgX2FkZEV4dGVybmFsSWRWZXJ0ZXhEaWNFbnRyeShfRWxlbWVudElkLCBfdmVydGV4KSB7XG4gICAgbGV0IF9kYmlkID0gX0VsZW1lbnRJZC5nZXQoKVxuICAgIGlmICh0eXBlb2YgX2RiaWQgPT0gXCJudW1iZXJcIilcbiAgICAgIGlmIChfZGJpZCAhPSAwKSB7XG4gICAgICAgIGxldCBleHRlcm5hbElkID0gYXdhaXQgVXRpbGl0aWVzLmdldEV4dGVybmFsSWQoX2RiaWQpXG4gICAgICAgIGlmICh0eXBlb2YgdGhpcy5leHRlcm5hbElkVmVydGV4RGljW2V4dGVybmFsSWRdID09PSBcInVuZGVmaW5lZFwiKVxuICAgICAgICAgIHRoaXMuZXh0ZXJuYWxJZFZlcnRleERpYy5hZGRfYXR0cih7XG4gICAgICAgICAgICBbZXh0ZXJuYWxJZF06IF92ZXJ0ZXhcbiAgICAgICAgICB9KVxuICAgICAgICBfRWxlbWVudElkLnVuYmluZCh0aGlzLl9hZGRFeHRlcm5hbElkVmVydGV4RGljRW50cnkuYmluZChudWxsLFxuICAgICAgICAgIF9FbGVtZW50SWQpKVxuICAgICAgfVxuICB9XG5cbiAgYWRkVmVydGV4KF9lbGVtZW50KSB7XG4gICAgaWYgKF9lbGVtZW50IGluc3RhbmNlb2YgQklNRWxlbWVudCAmJiB0eXBlb2YgdGhpcy5leHRlcm5hbElkVmVydGV4RGljW1xuICAgICAgICBfZWxlbWVudC5pZC5nZXQoKV0gIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgIGNvbnNvbGUubG9nKFwiQklNIE9CSkVDVCBOT0RFIEFMUkVBRFkgRVhJU1RTXCIpO1xuICAgICAgcmV0dXJuIHRoaXMuZXh0ZXJuYWxJZFZlcnRleERpY1tfZWxlbWVudC5pZC5nZXQoKV1cbiAgICB9IGVsc2Uge1xuICAgICAgbGV0IG5hbWUgPSBcIlwiXG4gICAgICBpZiAodHlwZW9mIF9lbGVtZW50Lm5hbWUgIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgbmFtZSA9IF9lbGVtZW50Lm5hbWUuZ2V0KCk7XG4gICAgICB9XG4gICAgICBsZXQgdmVydGV4ID0gbmV3IFNwaW5hbE5vZGUobmFtZSwgX2VsZW1lbnQsIHRoaXMpO1xuICAgICAgcmV0dXJuIHZlcnRleDtcblxuICAgIH1cbiAgfVxuXG4gIGNsYXNzaWZ5VmVydGV4KF92ZXJ0ZXgpIHtcbiAgICBVdGlsaXRpZXMucHJvbWlzZUxvYWQoX3ZlcnRleC5lbGVtZW50KS50aGVuKGVsZW1lbnQgPT4ge1xuICAgICAgX3ZlcnRleC5ncmFwaC5zZXQodGhpcyk7XG4gICAgICB0aGlzLnZlcnRleExpc3QubG9hZCh2ZXJ0ZXhMaXN0ID0+IHtcbiAgICAgICAgdmVydGV4TGlzdC5wdXNoKF92ZXJ0ZXgpXG4gICAgICB9KVxuICAgICAgbGV0IHR5cGUgPSBlbGVtZW50LmNvbnN0cnVjdG9yLm5hbWVcbiAgICAgIGlmICh0eXBlb2YgZWxlbWVudC50eXBlICE9IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgdHlwZSA9IGVsZW1lbnQudHlwZS5nZXQoKVxuICAgICAgfVxuICAgICAgaWYgKHRoaXMudmVydGV4TGlzdEJ5RWxlbWVudFR5cGVbdHlwZV0pIHtcbiAgICAgICAgdGhpcy52ZXJ0ZXhMaXN0QnlFbGVtZW50VHlwZVt0eXBlXS5sb2FkKFxuICAgICAgICAgIHZlcnRleExpc3RPZlR5cGUgPT4ge1xuICAgICAgICAgICAgdmVydGV4TGlzdE9mVHlwZS5wdXNoKF92ZXJ0ZXgpXG4gICAgICAgICAgfSlcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGxldCB2ZXJ0ZXhMaXN0T2ZUeXBlID0gbmV3IExzdCgpXG4gICAgICAgIHZlcnRleExpc3RPZlR5cGUucHVzaChfdmVydGV4KTtcbiAgICAgICAgdGhpcy52ZXJ0ZXhMaXN0QnlFbGVtZW50VHlwZS5hZGRfYXR0cih7XG4gICAgICAgICAgW3R5cGVdOiBuZXcgUHRyKFxuICAgICAgICAgICAgdmVydGV4TGlzdE9mVHlwZSlcbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICAgIGlmIChlbGVtZW50IGluc3RhbmNlb2YgQklNRWxlbWVudCkge1xuICAgICAgICBsZXQgX2RiaWQgPSBlbGVtZW50LmlkLmdldCgpXG4gICAgICAgIGlmICh0eXBlb2YgX2RiaWQgPT0gXCJudW1iZXJcIilcbiAgICAgICAgICBpZiAoX2RiaWQgIT0gMCkge1xuICAgICAgICAgICAgdGhpcy5fYWRkRXh0ZXJuYWxJZFZlcnRleERpY0VudHJ5KGVsZW1lbnQuaWQsIF92ZXJ0ZXgpXG4gICAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICBlbGVtZW50LmlkLmJpbmQodGhpcy5fYWRkRXh0ZXJuYWxJZFZlcnRleERpY0VudHJ5LmJpbmQobnVsbCxcbiAgICAgICAgICAgIGVsZW1lbnQuaWQsIF92ZXJ0ZXgpKVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSlcbiAgfVxuXG4gIGFkZFZlcnRpY2VzKF92ZXJ0aWNlcykge1xuICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBfdmVydGljZXMubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICB0aGlzLmNsYXNzaWZ5VmVydGV4KF92ZXJ0aWNlc1tpbmRleF0pXG4gICAgfVxuICB9XG5cbiAgYWRkUmVsYXRpb24oX3JlbGF0aW9uKSB7XG4gICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IF9yZWxhdGlvbi52ZXJ0ZXhMaXN0MS5sZW5ndGg7IGluZGV4KyspIHtcbiAgICAgIGNvbnN0IHZlcnRleCA9IF9yZWxhdGlvbi52ZXJ0ZXhMaXN0MVtpbmRleF07XG4gICAgICB2ZXJ0ZXguYWRkUmVsYXRpb24oX3JlbGF0aW9uKVxuICAgIH1cbiAgICBpZiAoX3JlbGF0aW9uLmlzRGlyZWN0ZWQuZ2V0KCkpIHtcbiAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBfcmVsYXRpb24udmVydGV4TGlzdDIubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICAgIGNvbnN0IHZlcnRleCA9IF9yZWxhdGlvbi52ZXJ0ZXhMaXN0MltpbmRleF07XG4gICAgICAgIHZlcnRleC5hZGREaXJlY3RlZFJlbGF0aW9uQ2hpbGQoX3JlbGF0aW9uKVxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgX3JlbGF0aW9uLnZlcnRleExpc3QyLmxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgICBjb25zdCB2ZXJ0ZXggPSBfcmVsYXRpb24udmVydGV4TGlzdDJbaW5kZXhdO1xuICAgICAgICB2ZXJ0ZXguYWRkUmVsYXRpb24oX3JlbGF0aW9uKVxuICAgICAgfVxuICAgIH1cbiAgICB0aGlzLl9jbGFzc2lmeVJlbGF0aW9uKF9yZWxhdGlvbik7XG4gIH1cblxuICBhZGRSZWxhdGlvbnMoX3JlbGF0aW9ucykge1xuICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBfcmVsYXRpb25zLmxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgY29uc3QgcmVsYXRpb24gPSBfcmVsYXRpb25zW2luZGV4XTtcbiAgICAgIHRoaXMuYWRkUmVsYXRpb24ocmVsYXRpb24pXG4gICAgfVxuICB9XG5cblxuXG4gIF9jbGFzc2lmeVJlbGF0aW9uKF9yZWxhdGlvbikge1xuICAgIHRoaXMucmVsYXRpb25MaXN0LmxvYWQocmVsYXRpb25MaXN0ID0+IHtcbiAgICAgIHJlbGF0aW9uTGlzdC5wdXNoKF9yZWxhdGlvbilcbiAgICB9KVxuICAgIGlmICh0aGlzLnJlbGF0aW9uTGlzdEJ5VHlwZVtfcmVsYXRpb24udHlwZS5nZXQoKV0pIHtcbiAgICAgIHRoaXMucmVsYXRpb25MaXN0QnlUeXBlW19yZWxhdGlvbi50eXBlLmdldCgpXS5sb2FkKFxuICAgICAgICByZWxhdGlvbkxpc3RPZlR5cGUgPT4ge1xuICAgICAgICAgIHJlbGF0aW9uTGlzdE9mVHlwZS5wdXNoKF9yZWxhdGlvbilcbiAgICAgICAgfSlcbiAgICB9IGVsc2Uge1xuICAgICAgbGV0IHJlbGF0aW9uTGlzdE9mVHlwZSA9IG5ldyBMc3QoKVxuICAgICAgcmVsYXRpb25MaXN0T2ZUeXBlLnB1c2goX3JlbGF0aW9uKTtcbiAgICAgIHRoaXMucmVsYXRpb25MaXN0QnlUeXBlLmFkZF9hdHRyKHtcbiAgICAgICAgW19yZWxhdGlvbi50eXBlLmdldCgpXTogbmV3IFB0cihcbiAgICAgICAgICByZWxhdGlvbkxpc3RPZlR5cGUpXG4gICAgICB9KVxuICAgIH1cbiAgfVxuXG4gIF9jbGFzc2lmeVJlbGF0aW9ucyhfcmVsYXRpb25zKSB7XG4gICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IF9yZWxhdGlvbnMubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICB0aGlzLmNsYXNzUmVsYXRpb24oX3JlbGF0aW9uc1tpbmRleF0pXG4gICAgfVxuICB9XG5cblxuXG4gIF9hZGROb3RFeGlzdGluZ1ZlcnRpY2VzRnJvbUxpc3QoX2xpc3QpIHtcbiAgICB0aGlzLnZlcnRleExpc3QubG9hZCh2ZXJ0ZXhMaXN0ID0+IHtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgX2xpc3QubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgbGV0IHZlcnRleCA9IF9saXN0W2ldO1xuICAgICAgICBpZiAoIVV0aWxpdGllcy5jb250YWlucyh2ZXJ0ZXhMaXN0LCB2ZXJ0ZXgpKSB7XG4gICAgICAgICAgdGhpcy5jbGFzc2lmeVZlcnRleCh2ZXJ0ZXgpXG4gICAgICAgICAgY29uc29sZS5sb2coXCJ0ZXN0XCIpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSlcbiAgfVxuXG4gIF9hZGROb3RFeGlzdGluZ1ZlcnRpY2VzRnJvbVJlbGF0aW9uKF9yZWxhdGlvbikge1xuICAgIHRoaXMuX2FkZE5vdEV4aXN0aW5nVmVydGljZXNGcm9tTGlzdChfcmVsYXRpb24udmVydGV4TGlzdDEpXG4gICAgdGhpcy5fYWRkTm90RXhpc3RpbmdWZXJ0aWNlc0Zyb21MaXN0KF9yZWxhdGlvbi52ZXJ0ZXhMaXN0MilcbiAgfVxuXG59XG5cbnNwaW5hbENvcmUucmVnaXN0ZXJfbW9kZWxzKFtHcmFwaF0pIl19